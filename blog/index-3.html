<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="es">
<head>
<meta charset="utf-8">
<meta name="description" content="Comunidad Python Piura">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Python Piura (publicaciones antiguas, página 3) | Python Piura</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href="http://pythonpiura.org/blog/index-3.html">
<link rel="prev" href="." type="text/html">
<link rel="next" href="index-2.html" type="text/html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Ir al contenido principal</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Mostrar navegación</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://pythonpiura.org/">

                <span id="blog-title">Python Piura</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../blog">Blog</a>
                </li>
<li>
<a href="../eventos">Eventos</a>
                </li>
<li>
<a href="../recursos">Recursos</a>
                </li>
<li>
<a href="../contactenos">Contáctenos</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="../posts/configurando-un-proxy-inverso-para-odoo-10/" class="u-url">Configurando un Proxy Inverso para Odoo 10</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Comunidad Python Piura
            </span></p>
            <p class="dateline"><a href="../posts/configurando-un-proxy-inverso-para-odoo-10/" rel="bookmark"><time class="published dt-published" datetime="2017-01-19T11:09:29-05:00" title="2017-01-19 11:09">2017-01-19 11:09</time></a></p>
                <p class="commentline">
        
    <a href="../posts/configurando-un-proxy-inverso-para-odoo-10/#disqus_thread" data-disqus-identifier="cache/posts/configurando-un-proxy-inverso-para-odoo-10.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Teniendo en cuenta la configuración realizada en nuestro anterior artículo <a class="reference external" href="../posts/instalacion-odoo-10-en-produccion/">Instalación de Odoo 10 en Producción</a>
en esta oportunidad, vamos a configurar un proxy inverso para poder acceder a nuestro odoo mediante el puerto 80, en otro artículo haremos lo mismo para el protocolo https usando el puerto 443, debemos recalcar que en esta oportunidad hemos utilizado como guía el libro "Odoo 10 Development Essentials" de Daniel Reis, entonces manos a la obra.</p>
<p>Odoo puede servir páginas web por si mismo, pero se recomienda tener un proxy Inverso en frente. Un proxy inverso actúa como un intermediario que gestiona el tráfico entre los clientes que envían solicitudes y el servidor Odoo que les responde. El uso de un proxy inverso tiene varios beneficios.</p>
<p>A nivel de seguridad:</p>
<ul class="simple">
<li>Manejar (y hacer cumplir) los protocolos HTTPS para cifrar el tráfico</li>
<li>Ocultar las características de la red interna</li>
<li>Actuar como un cortafuegos que limita las URL aceptadas para el procesamiento</li>
</ul>
<p>A nivel de rendimiento:</p>
<ul class="simple">
<li>Caché de contenido estático, reduciendo así la carga en los servidores Odoo</li>
<li>Comprimir contenido para acelerar los tiempos de carga</li>
<li>Actuar como un equilibrador de carga, distribuyendola entre varios servidores.</li>
</ul>
<p>Apache es una opción popular para usar como un proxy inverso, pero en esta oportunidad usaremos Nginx, Nginx es una alternativa reciente con buenas características técnicas y fácil de configurar.</p>
<div class="section" id="configurando-nginx-como-proxy-inverso">
<h2>Configurando Nginx como Proxy Inverso</h2>
<p>Nginx, escucha en los puertos HTTP predeterminados(80), por lo que debemos asegurarnos que ninguna otra aplicación esté usando estos puertos, probaremos esto con la herramienta curl:</p>
<pre class="code bash"><a name="rest_code_548d09f6f6b5414fab6d02ef20edec54-1"></a>apt-get install curl
<a name="rest_code_548d09f6f6b5414fab6d02ef20edec54-2"></a>curl http://localhost
</pre>
<p>Si nos sale un mensaje como el siguiente entonces el puerto está libre:</p>
<pre class="code bash"><a name="rest_code_37128db7caa040c6b6cb81fd3b8e586a-1"></a>curl: <span class="o">(</span>7<span class="o">)</span> Failed to connect to localhost port 80: Conexión rehusada
</pre>
<p>Ahora procedemos a instalar nginx:</p>
<pre class="code bash"><a name="rest_code_8ece38c9019d4d098bb0389df87e4130-1"></a>apt-get install nginx
</pre>
<p>Para confirmar que está funcionando correctamente debemos ver una página de bienvenida cuando visitemos el servidor con un navegador web o usando curl:</p>
<p><a class="reference external" href="http://IP_SERVER">http://IP_SERVER</a></p>
<p>Los archivos de configuración de Nginx siguen el mismo enfoque que Apache se almacenan en:</p>
<pre class="code bash"><a name="rest_code_27962c11c379475db20307cab7bad630-1"></a>/etc/nginx/available-sites/
</pre>
<p>Y se activan añadiendo un enlace simbólico en:</p>
<pre class="code bash"><a name="rest_code_6abe33fa794246cd9a53fb77ddab5336-1"></a>/etc/nginx/enabled-sites
</pre>
<p>También debemos desactivar la configuración predeterminada proporcionada por la instalación de Nginx, borrando el archivo default:</p>
<pre class="code bash"><a name="rest_code_0ace42ed1b0f461197d653e8426f5c3d-1"></a>rm /etc/nginx/sites-enabled/default
</pre>
<p>Ahora creamos el archivo para odoo:</p>
<pre class="code bash"><a name="rest_code_5a8e0ec772d140e3ab6a048ea8f58226-1"></a>nano /etc/nginx/sites-available/odoo
</pre>
<p>y le agregamos el siguiente contenido:</p>
<pre class="code bash"><a name="rest_code_22cebd8fa4c04f5e94d5881f823e6501-1"></a>upstream backend-odoo<span class="o">{</span>
<a name="rest_code_22cebd8fa4c04f5e94d5881f823e6501-2"></a>        server 127.0.0.1:8069<span class="p">;</span>
<a name="rest_code_22cebd8fa4c04f5e94d5881f823e6501-3"></a><span class="o">}</span>
<a name="rest_code_22cebd8fa4c04f5e94d5881f823e6501-4"></a>
<a name="rest_code_22cebd8fa4c04f5e94d5881f823e6501-5"></a>server<span class="o">{</span>
<a name="rest_code_22cebd8fa4c04f5e94d5881f823e6501-6"></a>        location / <span class="o">{</span>
<a name="rest_code_22cebd8fa4c04f5e94d5881f823e6501-7"></a>                proxy_pass http://backend-odoo<span class="p">;</span>
<a name="rest_code_22cebd8fa4c04f5e94d5881f823e6501-8"></a>        <span class="o">}</span>
<a name="rest_code_22cebd8fa4c04f5e94d5881f823e6501-9"></a><span class="o">}</span>
</pre>
<p>Primero, agregamos los upstreams, y los servidores backend Nginx redirigirán el tráfico al servidor Odoo en que está escuchando en el puerto 8069</p>
<p>Añadimos el enlace simbólico:</p>
<pre class="code bash"><a name="rest_code_469d05f099664ba2b39788f841010472-1"></a>ln -s /etc/nginx/sites-available/odoo /etc/nginx/sites-enabled/odoo
</pre>
<p>Para testear si la configuración es correcta hacemos lo siguiente:</p>
<pre class="code bash"><a name="rest_code_5f54f9f13b684efb816a948e45618786-1"></a>nginx -t
</pre>
<p>Si hay errores revisar si hemos escrito correctamente la configuración en el archivo odoo.</p>
<p>Recargamos nginx:</p>
<pre class="code bash"><a name="rest_code_4c33912bd6cd49fa9e6fee3f47f6e52c-1"></a>/etc/init.d/nginx reload
</pre>
<p>Y visitamos nuestro servidor a través del navegador web:</p>
<pre class="code bash"><a name="rest_code_68fa3a84570d4971bccb3851832c99ac-1"></a>http://IP_SERVER
</pre>
<p>Este nos redirigirá automáticamente a Odoo, eso es todo por hoy.</p>
<p>Saludos.</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="../posts/instalacion-odoo-10-en-produccion/" class="u-url">Instalación de Odoo 10 en Producción</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Comunidad Python Piura
            </span></p>
            <p class="dateline"><a href="../posts/instalacion-odoo-10-en-produccion/" rel="bookmark"><time class="published dt-published" datetime="2017-01-16T23:56:00-05:00" title="2017-01-16 23:56">2017-01-16 23:56</time></a></p>
                <p class="commentline">
        
    <a href="../posts/instalacion-odoo-10-en-produccion/#disqus_thread" data-disqus-identifier="cache/posts/instalacion-odoo-10-en-produccion.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Ultimamente estamos trabajando con Odoo 10 y queremos compartir con ustedes la instalación de este genial software sobre un servidor Debian Jessie listo para ponerlo en producción, este es el primer artículo sobre el tema, el segundo estará siendo lanzado en los proximos días. Para escribir este artículo hemos tenido en cuenta los libros "Odoo Development Cookbook" y "Odoo 10      Development     Essentials"</p>
<p>Lo primero que debemos hacer es instalar Debian, los pasos para esto no los vamos a tener en cuenta en este artículo, ya que hay muy buenos tutoriales en la red.</p>
<p>Una vez instalado Debian es ingresar como root y actualizar el software:</p>
<pre class="code bash"><a name="rest_code_c3e8635593be47d08911cb455f696847-1"></a>apt update <span class="o">&amp;&amp;</span> apt upgrade
</pre>
<p>Ahora instalamos los paquetes necesarios que nos permitiran el correcto funcionamiento de Odoo</p>
<pre class="code bash"><a name="rest_code_c4790216048249b2986b8739d9133c2a-1"></a>apt-get install git python2.7 postgresql nano python-virtualenv <span class="se">\</span>
<a name="rest_code_c4790216048249b2986b8739d9133c2a-2"></a>gcc python2.7-dev libxml2-dev libxslt1-dev <span class="se">\</span>
<a name="rest_code_c4790216048249b2986b8739d9133c2a-3"></a>libevent-dev libsasl2-dev libldap2-dev libpq-dev <span class="se">\</span>
<a name="rest_code_c4790216048249b2986b8739d9133c2a-4"></a>libpng12-dev libjpeg-dev node-less node-clean-css <span class="se">\</span>
<a name="rest_code_c4790216048249b2986b8739d9133c2a-5"></a>xfonts-75dpi xfonts-base
</pre>
<p>En odoo los reportes se generan usando la librería wkhtmltox, por lo que es necesario primero descargarla:</p>
<pre class="code bash"><a name="rest_code_17b3116234a04855b06c3cd41f0b6031-1"></a>wget http://nightly.odoo.com/extra/wkhtmltox-0.12.1.2_linux-jessie-amd64.deb
</pre>
<p>Y luego instalarla:</p>
<pre class="code bash"><a name="rest_code_f172eee6ea6e425b9b2adc8be3c1f8c2-1"></a>dpkg -i wkhtmltox-0.12.1.2_linux-jessie-amd64.deb
</pre>
<p>Creamos el usuario odoo:</p>
<pre class="code bash"><a name="rest_code_6ce6d051cd39411cbdb143e5041844cf-1"></a>adduser odoo
</pre>
<p>Instalamos sudo para poder realizar algunas operaciones necesarias con permisos de superusuario:</p>
<pre class="code bash"><a name="rest_code_c92aad3080474a5196cd72baa227c001-1"></a>apt install sudo
</pre>
<p>Creamos el usuario de base de datos odoo, esto lo hacemos con el usuario postgres:</p>
<pre class="code bash"><a name="rest_code_f82b125484f349dbaf16681b738d2730-1"></a>sudo -u postgres createuser odoo
</pre>
<p>Si nos aparece el sguiente mensaje:</p>
<pre class="code bash"><a name="rest_code_d679440358d842da8f92742cef731742-1"></a>could not change directory to <span class="s2">"/root"</span>: Permiso denegado
</pre>
<p>No debemos preocuparnos y procedemos a crear la base de datos odoo-project y la asignamos al usuario odoo:</p>
<pre class="code bash"><a name="rest_code_d988dcba70ba483bb5f6e1c8d94caa66-1"></a>sudo -u postgres createdb -O odoo odoo-project
</pre>
<p>Ahora nos cambiamos al usuario odoo:</p>
<pre class="code bash"><a name="rest_code_c733f364ae73473d9c0a40233db5d252-1"></a>su odoo
</pre>
<p>Creamos la carpeta odoo-prod donde vamos a guardar todos los archivos y carpetas necesarias de odoo:</p>
<pre class="code bash"><a name="rest_code_898f46e753fc4e9392e59bf28588aaa1-1"></a>mkdir ~/odoo-prod
</pre>
<p>Fijémonos que antes del nombre de la carpeta tenemos los caracteres     "~/", con esto indicamos que no importa la carpeta donde estemos situados actualmente, siempre la creará en el home del usuario en sesión.</p>
<p>Ahora ingresamos a la carpeta creada:</p>
<pre class="code bash"><a name="rest_code_a87bebd6b7b0407c976d216d318b00a4-1"></a><span class="nb">cd</span> ~/odoo-prod
</pre>
<p>Y dentro de esta creamos las carpetas project y src dentro de project:</p>
<pre class="code bash"><a name="rest_code_8bdd488ffc3f49eebf7a4e9b688d07ad-1"></a>mkdir -p project/src
</pre>
<p>Ingresamos a la carpeta src donde guardaremos el código de odoo:</p>
<pre class="code bash"><a name="rest_code_e38dd8f242df43b1a77121b306812dd0-1"></a><span class="nb">cd</span> project/src
</pre>
<p>Ahora clonamos desde github el código fuente de odoo:</p>
<pre class="code bash"><a name="rest_code_6b8fe420c8824e58b4c69bf7941ad3cd-1"></a>git clone -b 10.0 --depth<span class="o">=</span><span class="m">1</span> https://github.com/odoo/odoo.git odoo
</pre>
<p>Observemos el parámetro --depth=1, este parámetro ignora la historia de los cambios y recupera sólo la última revisión de código, haciendo la descarga mucho más rápida.</p>
<p>Creamos un entorno virtual para trabajar con Odoo:</p>
<pre class="code bash"><a name="rest_code_848904cbc4304405aa2af3dfa270bbbd-1"></a>virtualenv ~/env-odoo-10.0
</pre>
<p>Activamos el entorno virtual:</p>
<pre class="code bash"><a name="rest_code_f01c70166a2640bcb94420c83d64d257-1"></a><span class="nb">source</span> ~/env-odoo-10.0/bin/activate
</pre>
<p>Instalamos las dependencias necesarias para odoo 10:</p>
<pre class="code bash"><a name="rest_code_2c46610228d14f54a7197ee4636ed6b2-1"></a>pip install -r odoo/requirements.txt
</pre>
<p>Hasta aquí ya podemos correr odoo sin ningún problema usando el script odoo-bin ubicado en el código fuente de odoo, pero continuaremos haciendo algunos pasos adicionales para obtener una mejor performance.</p>
<p>Procedemos a crear la carpeta bin dentro de project:</p>
<pre class="code bash"><a name="rest_code_03f94c8b070248148d506ba090a5268e-1"></a>mkdir ~/odoo-prod/project/bin
</pre>
<p>Ahora vamos a generar nuestro archivo de configuración de odoo, llamado production.conf, utilizando la siguiente orden:</p>
<pre class="code bash"><a name="rest_code_ff5a5e6bab8347e793ec734725bd2b96-1"></a>~/odoo-prod/project/src/odoo/odoo-bin --save --config ~/odoo-prod/project/production.conf --stop-after-init
</pre>
<p>Los parámetros --save y --config nos permiten crear y guardar el archivo de configuración en la ruta indicada, con el parámetro --stop-after-init paramos la ejecución de odoo y volvemos a la terminal.</p>
<p>Ahora vamos a crear el archivo que arrancará nuestro odoo, le vamos a denominar start-odoo y va a estar ubicado en la carpeta bin:</p>
<pre class="code bash"><a name="rest_code_a5538bffebad461685ffbba91db8dbbf-1"></a>nano ~/odoo-prod/project/bin/start-odoo
</pre>
<p>Este archivo es un script que contendrá lo siguiente:</p>
<pre class="code bash"><a name="rest_code_d49fb3417edf458c9fc194a7f248881b-1"></a><span class="ch">#! /bin/sh</span>
<a name="rest_code_d49fb3417edf458c9fc194a7f248881b-2"></a><span class="nv">PYTHON</span><span class="o">=</span>~odoo/env-odoo-10.0/bin/python
<a name="rest_code_d49fb3417edf458c9fc194a7f248881b-3"></a><span class="nv">ODOO</span><span class="o">=</span>~odoo/odoo-prod/project/src/odoo/odoo-bin
<a name="rest_code_d49fb3417edf458c9fc194a7f248881b-4"></a><span class="nv">CONF</span><span class="o">=</span>~odoo/odoo-prod/project/production.conf
<a name="rest_code_d49fb3417edf458c9fc194a7f248881b-5"></a><span class="si">${</span><span class="nv">PYTHON</span><span class="si">}</span> <span class="si">${</span><span class="nv">ODOO</span><span class="si">}</span> -c <span class="si">${</span><span class="nv">CONF</span><span class="si">}</span>
</pre>
<p>El detalle de este archivo se explica de la siguiente manera:</p>
<p>-Tenemos el intérprete del entorno virtual, con esto nos despreocupamos de estar activando el entorno virtual cada vez que querramos arrancar el odoo.</p>
<p>-El script que viene en el código de odoo y que inicia la aplicación, se llama odoo-bin.</p>
<p>-El archivo de configuración de odoo, llamado production.conf</p>
<p>-Y finalmente el llamado a la orden que arranca odoo utilizando los parámetros contenidos en el archivo de configuración.</p>
<p>Le damos permisos de ejecución al script start-odoo</p>
<pre class="code bash"><a name="rest_code_940affa219b74bc49f022c4e51bd81cb-1"></a>chmod +x ~/odoo-prod/project/bin/start-odoo
</pre>
<p>Para probarlo arranquemos el script:</p>
<pre class="code bash"><a name="rest_code_0c03be2b9fc6493b9c6620ebbf252d80-1"></a>~/odoo-prod/project/bin/start-odoo
</pre>
<p>Y probemos que funciona correctamente poniendo la IP del servidor y el puerto 8069:</p>
<p><a class="reference external" href="http://IP_SERVER_ODOO:8069">http://IP_SERVER_ODOO:8069</a></p>
<div class="section" id="tuneando-postgresql">
<h2>Tuneando PostgreSQL</h2>
<p>La configuración predeterminada de PostgreSQL es generalmente muy conservadora y tiene la intención de evitar que el servidor de base de datos acapare todos los recursos del sistema. En servidores de producción, se pueden aumentar algunos parámetros en el archivo postgresql.conf para obtener un mejor rendimiento.</p>
<p>Vamos a editar el archivo postgresql.conf:</p>
<pre class="code bash"><a name="rest_code_b00f16c3ca9c4597a3212329eacb3e9f-1"></a>nano /etc/postgresql/9.4/main/postgresql.conf
</pre>
<p>Estas son algunas de las opciones que utilizaremos:</p>
<pre class="code bash"><a name="rest_code_d53245d47ac94cc499b21754a5edd17a-1"></a><span class="nv">max_connections</span> <span class="o">=</span> 100
<a name="rest_code_d53245d47ac94cc499b21754a5edd17a-2"></a><span class="nv">shared_buffers</span> <span class="o">=</span> 256MB
<a name="rest_code_d53245d47ac94cc499b21754a5edd17a-3"></a><span class="nv">effective_cache_size</span> <span class="o">=</span> 768MB
<a name="rest_code_d53245d47ac94cc499b21754a5edd17a-4"></a><span class="nv">work_mem</span> <span class="o">=</span> 10MB
<a name="rest_code_d53245d47ac94cc499b21754a5edd17a-5"></a><span class="nv">maintenance_work_mem</span> <span class="o">=</span> 64MB
<a name="rest_code_d53245d47ac94cc499b21754a5edd17a-6"></a><span class="nv">checkpoint_segments</span> <span class="o">=</span> 16
<a name="rest_code_d53245d47ac94cc499b21754a5edd17a-7"></a><span class="nv">wal_buffers</span> <span class="o">=</span> 8MB
<a name="rest_code_d53245d47ac94cc499b21754a5edd17a-8"></a><span class="nv">checkpoint_completion_target</span> <span class="o">=</span> 0.9
</pre>
<p>Para modificar el archivo procedemos a buscar cada uno de los parámetros y lo editamos o lo descomentamos según sea el caso.</p>
<p>Ahora reiniciamos el servicio de base de datos:</p>
<pre class="code bash"><a name="rest_code_411ebc0963024518bd4657b0c9b666bb-1"></a>service postgresql restart
</pre>
</div>
<div class="section" id="editando-archivo-de-configuracion-de-odoo">
<h2>Editando Archivo de Configuración de Odoo</h2>
<p>Ahora vamos a editar el archivo production.conf para modificar los parámetros necesarios para obtener un mejor rendimiento:</p>
<pre class="code bash"><a name="rest_code_c5c2c113d56348e39378f55390fb9150-1"></a>nano ~/odoo-prod/project/production.conf
</pre>
<p>Los parámetros a modificar serán los siguientes:</p>
<p>Cambio del directorio de datos:</p>
<pre class="code bash"><a name="rest_code_9b13eaca35ba494c95aa9a388a5d027a-1"></a><span class="nv">data_dir</span> <span class="o">=</span> /home/odoo/odoo-prod/project/data
</pre>
<p>Cambio del log del servidor:</p>
<pre class="code bash"><a name="rest_code_d1d01501412f448eb4fa0b21903c4b84-1"></a><span class="nv">logfile</span> <span class="o">=</span> /home/odoo/odoo-prod/project/logs/odoo.log
</pre>
<p>Configuración de la rotación del log, esto permite la rotación de registros. Esto hará que Odoo configure el módulo de registro para archivar los registros del servidor diariamente y mantener los registros antiguos durante 30 días. Esto es útil en servidores de producción para evitar registros que eventualmente consumen todo el espacio disponible en el disco.:</p>
<pre class="code bash"><a name="rest_code_d14b8d3e79d74432b56d6254629e3e48-1"></a><span class="nv">logrotate</span> <span class="o">=</span> True
</pre>
<p>Configuración de los manejadores de login, esto configura el nivel de registro. La configuración propuesta es muy conservadora y sólo registrará mensajes con al menos el nivel WARNING, excepto werkzeug (CRITICAL) y openerp.service.server (INFO):</p>
<pre class="code bash"><a name="rest_code_24892e64413c4eebb0f37057f3bc92e9-1"></a><span class="nv">log_level</span> <span class="o">=</span> warn
<a name="rest_code_24892e64413c4eebb0f37057f3bc92e9-2"></a><span class="nv">log_handler</span> <span class="o">=</span> :WARNING,werkzeug:CRITICAL,openerp.service.server:INFO
</pre>
<p>Adaptación de los parámetros de conexión, esto funcionará si está ejecutando el servidor de base de datos PostgreSQL localmente y lo ha configurado como se explicó en anteriormente. Si se está ejecutando PostgreSQL en un servidor diferente, se tendrá que reemplazar los valores False con la configuración de conexión adecuada para su instancia de base de datos:</p>
<pre class="code bash"><a name="rest_code_2c3085096ae74e1db12f24d4cd235afd-1"></a><span class="nv">db_host</span> <span class="o">=</span> False
<a name="rest_code_2c3085096ae74e1db12f24d4cd235afd-2"></a><span class="nv">db_maxconn</span> <span class="o">=</span> 64
<a name="rest_code_2c3085096ae74e1db12f24d4cd235afd-3"></a><span class="nv">db_name</span> <span class="o">=</span> odoo-project
<a name="rest_code_2c3085096ae74e1db12f24d4cd235afd-4"></a><span class="nv">db_password</span> <span class="o">=</span> False
<a name="rest_code_2c3085096ae74e1db12f24d4cd235afd-5"></a><span class="nv">db_port</span> <span class="o">=</span> False
<a name="rest_code_2c3085096ae74e1db12f24d4cd235afd-6"></a><span class="nv">db_template</span> <span class="o">=</span> template1
<a name="rest_code_2c3085096ae74e1db12f24d4cd235afd-7"></a><span class="nv">db_user</span> <span class="o">=</span> False
</pre>
<p>Configuración del filtro de bases de datos y del listado de bases de datos, esto restringe las bases de datos disponibles para la instancia configurando un filtro de base de datos.
Se desactiva el listado de las base de datos, esto no es estrictamente necesario dado que la expresión regular que establecemos en dbfilter sólo puede coincidir con una base de datos única. Sin embargo esto se hace para evitar mostrar la lista de bases de datos y que los usuarios se conecten a la base de datos incorrecta:</p>
<pre class="code bash"><a name="rest_code_675563aecae24c5abfa4d8c329b40e0e-1"></a><span class="nv">dbfilter</span> <span class="o">=</span> odoo-project$
<a name="rest_code_675563aecae24c5abfa4d8c329b40e0e-2"></a><span class="nv">list_db</span> <span class="o">=</span> False
</pre>
<p>Cambio del master password, la contraseña maestra se utiliza para la administración de la base de datos a través de la interfaz de usuario, y algunos addons de la comunidad también lo utilizan para añadir seguridad adicional antes de realizar acciones que pueden conducir a la pérdida de datos.:</p>
<pre class="code bash"><a name="rest_code_b0be5333e81b41dc8d6c4ebff1fe7bf4-1"></a><span class="nv">admin_password</span> <span class="o">=</span> mypassword
</pre>
<p>Configuración de los workers, Odoo creará una serie de procesos de trabajo (en este ejemplo, 4) para manejar las solicitudes HTTP. Esto tiene varias ventajas sobre la configuración por defecto en la cual el manejo de la petición se realiza en hilos separados:</p>
<pre class="code bash"><a name="rest_code_ccdeefee11d745e090cc819650db078c-1"></a><span class="nv">workers</span> <span class="o">=</span> 4
<a name="rest_code_ccdeefee11d745e090cc819650db078c-2"></a><span class="nv">limit_memory_hard</span> <span class="o">=</span> <span class="m">4294967296</span> <span class="c1"># 4 GB</span>
<a name="rest_code_ccdeefee11d745e090cc819650db078c-3"></a><span class="nv">limit_memory_soft</span> <span class="o">=</span> <span class="m">671088640</span> <span class="c1"># 640MB</span>
<a name="rest_code_ccdeefee11d745e090cc819650db078c-4"></a><span class="nv">limit_request</span> <span class="o">=</span> 8192
<a name="rest_code_ccdeefee11d745e090cc819650db078c-5"></a><span class="nv">limit_time_cpu</span> <span class="o">=</span> 120
<a name="rest_code_ccdeefee11d745e090cc819650db078c-6"></a><span class="nv">limit_time_real</span> <span class="o">=</span> 300
</pre>
<p>Si queremos que el sistema cargue datos de prueba debemos mantener el parámetro without_demo en False y si queremos lo contrario lo ponemos a True:</p>
<pre class="code bash"><a name="rest_code_c94436cda8c44d4094866fc52291e6ea-1"></a><span class="nv">without_demo</span> <span class="o">=</span> False
</pre>
</div>
<div class="section" id="arranque-automatico">
<h2>Arranque Automático</h2>
<p>Ahora vamos a configurar systemd para iniciar Odoo automáticamente.</p>
<p>Si aún seguimos logueados con el usuario odoo, debemos salir y regresar a trabajar con el usuario root:</p>
<pre class="code bash"><a name="rest_code_35c9b4bb106c4355b2099cff6d4be66f-1"></a><span class="nb">exit</span>
</pre>
<p>Creamos el archivo llamado odoo.service en /lib/systemd/system/ de la siguiente manera:</p>
<pre class="code bash"><a name="rest_code_72fae6b3792e42cdac4a60053ade202d-1"></a>nano /lib/systemd/system/odoo.service
</pre>
<p>Este archivo tendrá el siguiente contenido:</p>
<pre class="code bash"><a name="rest_code_db1d37ba05ca4a45a6246df52d189e48-1"></a><span class="o">[</span>Unit<span class="o">]</span>
<a name="rest_code_db1d37ba05ca4a45a6246df52d189e48-2"></a><span class="nv">Description</span><span class="o">=</span>Odoo 10.0
<a name="rest_code_db1d37ba05ca4a45a6246df52d189e48-3"></a><span class="nv">After</span><span class="o">=</span>postgresql.service
<a name="rest_code_db1d37ba05ca4a45a6246df52d189e48-4"></a>
<a name="rest_code_db1d37ba05ca4a45a6246df52d189e48-5"></a><span class="o">[</span>Service<span class="o">]</span>
<a name="rest_code_db1d37ba05ca4a45a6246df52d189e48-6"></a><span class="nv">Type</span><span class="o">=</span>simple
<a name="rest_code_db1d37ba05ca4a45a6246df52d189e48-7"></a><span class="nv">User</span><span class="o">=</span>odoo
<a name="rest_code_db1d37ba05ca4a45a6246df52d189e48-8"></a><span class="nv">Group</span><span class="o">=</span>odoo
<a name="rest_code_db1d37ba05ca4a45a6246df52d189e48-9"></a><span class="nv">ExecStart</span><span class="o">=</span>/home/odoo/odoo-prod/project/bin/start-odoo
<a name="rest_code_db1d37ba05ca4a45a6246df52d189e48-10"></a>
<a name="rest_code_db1d37ba05ca4a45a6246df52d189e48-11"></a><span class="o">[</span>Install<span class="o">]</span>
<a name="rest_code_db1d37ba05ca4a45a6246df52d189e48-12"></a><span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre>
<p>Registramos el servicio:</p>
<pre class="code bash"><a name="rest_code_eba7e2e7885f41b6912e75d013bc7484-1"></a>systemctl <span class="nb">enable</span> odoo.service
</pre>
<p>Iniciamos el servicio:</p>
<pre class="code bash"><a name="rest_code_dc9158dc32c640a2a9442c35941acb60-1"></a>service odoo start
</pre>
<p>Revisamos que al menos esté corriendo:</p>
<pre class="code bash"><a name="rest_code_cfc7000ee6524fadaf0c443d127a31b6-1"></a>service odoo status
</pre>
<p>Y lo paramos:</p>
<pre class="code bash"><a name="rest_code_a6d3ee0aafd3436495bb9fe00f30759d-1"></a>service odoo stop
</pre>
<p>Para probar el funcionamiento reiniciemos el servidor y veamos que odoo esté corriendo correctamente:</p>
<pre class="code bash"><a name="rest_code_f0bd56aee7c34de6890581e380c480f8-1"></a>reboot
</pre>
<p>Ahora probemos nuevamente:</p>
<p><a class="reference external" href="http://IP_SERVER_ODOO:8069">http://IP_SERVER_ODOO:8069</a></p>
<p>Y debemos ver la página de inicio del odoo.</p>
<p>El siguiente artículo nos permitirá configurar odoo con nginx y estará muy bueno, hasta la próxima.</p>
<p>Saludos.</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="../posts/migrando-de-wordpress-a-nikola/" class="u-url">Migrando de Wordpress a Nikola</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Comunidad Python Piura
            </span></p>
            <p class="dateline"><a href="../posts/migrando-de-wordpress-a-nikola/" rel="bookmark"><time class="published dt-published" datetime="2016-07-02T05:01:23Z" title="2016-07-02 05:01">2016-07-02 05:01</time></a></p>
                <p class="commentline">
        
    <a href="../posts/migrando-de-wordpress-a-nikola/#disqus_thread" data-disqus-identifier="cache/posts/migrando-de-wordpress-a-nikola.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Despues de haber trabajado durante mucho tiempo en Wordpress decidimos usar algo mas pythonesco y encontramos el proyecto Nikola, que se adapta muy bien a lo que nosotros necesitamos como comunidad, asi que decidimos migrar, para ello seguimos la documentacion oficial del proyecto y algunos tutoriales adicionales, en este post vamos a relatar nuestra experiencia, esperando que sea util a nuestros lectores.</p>
<p>Primero creamos nuestro entorno virtual, en esta oportunidad usamos python3 para obtener un mejor rendimiento con Nikola,</p>
<pre class="code bash"><a name="rest_code_d24b0cc88f774457a8dd99bd1e398c18-1"></a>python3 -m venv nikola
</pre>
<p>Activamos el entorno virtual:</p>
<pre class="code bash"><a name="rest_code_537ce5700b0349f896bcda574672939e-1"></a><span class="nb">source</span> nikola/bin/activate
</pre>
<p>Antes de iniciar la instalacion de Nikola debimos instalar algunas dependencias para asegurarnos que todo funcione sin ningun problema:</p>
<pre class="code bash"><a name="rest_code_e4eed4002c944c40997a08d792eca47b-1"></a>sudo apt-get install python3-dev
<a name="rest_code_e4eed4002c944c40997a08d792eca47b-2"></a>sudo apt-get install libxml2-dev libxslt1-dev zlib1g-dev
<a name="rest_code_e4eed4002c944c40997a08d792eca47b-3"></a>sudo apt-get build-dep python3-lxml python3-pil
</pre>
<p>Luego de ello debimos hacer una actualizacion de pip por un problema raro que se nos estaba presentando en la instalacion:</p>
<pre class="code bash"><a name="rest_code_fc8e4b57d1ec4cbabd2aa0c43f2f6af3-1"></a>pip install --upgrade pip
</pre>
<p>Luego procedimos a instalar Nikola y lo hicimos, de acuerdo a la sugerencia de su propia pagina, de la siguiente manera:</p>
<pre class="code bash"><a name="rest_code_6f7d3abc257249c9a78711ad0365bcf5-1"></a>pip install --upgrade <span class="s2">"Nikola[extras]"</span>
</pre>
<p>Nos demoramos un poquito, pero finalmente ya teniamos a Nikola instalado en nuestra maquina, como a nosotros no nos interesaba iniciar un sitio desde cero, sino migrar el que ya tenemos en wordpress, hicimos un backup del contenido del blog en wordpress, que es descargado en formato xml, el nuestro se llama pythonpiura.wordpress.2016-06-28.xml y las indicaciones para hacerlo son bastante sencillas y estan explicadas en la documentacion del propio wordpress.
Para hacer la migracion de Wordpress a Nikola leimos rapidamente el manual y encontramos que teniamos 3 opciones, probamos las tres para ver cual nos resultaba mejor, pero antes debimos ingresar en la ruta donde tenemos nuestro archivo xml con el backup, debemos mencionar que las tres opciones nos crean una carpeta new_site.</p>
<p>1-La opcion por defecto:</p>
<pre class="code bash"><a name="rest_code_edda53a799364746b2b34ff36c1d7f17-1"></a>nikola import_wordpress pythonpiura.wordpress.2016-06-28.xml
</pre>
<p>Esta opcion descarga todo el contenido del blog de wordpress e intenta hacer una conversion de cada uno de los posts y paginas al formato .md, no nos funciono correctamente ya que muchos posts se migraron a medias.</p>
<p>2-Convertir los posts a html:</p>
<pre class="code bash"><a name="rest_code_e7059d68c1404833a4eaaceb27ed7dd3-1"></a>nikola import_wordpress --transform-to-html pythonpiura.wordpress.2016-06-28.xml
</pre>
<p>Para ello primero debemos instalar el plugin de conversion a wordpress</p>
<pre class="code bash"><a name="rest_code_8b83d7c8823d4fb680240f0173aa4c4a-1"></a>nikola plugin -i wordpress_compiler
</pre>
<p>Esta opcion descarga el contenido y convierte los posts y paginas a html, esta fue la opcion que mejor nos funciono, salvo por el problema con los ejemplos de codigo que tenemos y que llevan la etiqueta:</p>
<pre class="code html"><a name="rest_code_f50e4b8b24b94dbdad1c7797c52fe140-1"></a>[sourcecode language="language"]
</pre>
<p>Hasta donde hemos visto no es posible llevar a cabo la conversion de esto a un formato adecuado asi que simplemente los deja con el texto normal sin darle ningun formato, por lo que este todavia es un tema pendiente de resolver.</p>
<p>3-Dejar el contenido como formato de wordpress, los archivos de los posts y las paginas tienen las extension .wp</p>
<pre class="code bash"><a name="rest_code_9b83ae63fab3490d9a749b2617a8b61c-1"></a>nikola import_wordpress --use-wordpress-compiler pythonpiura.wordpress.2016-06-28.xml
</pre>
<p>Probamos esta opcion pensando que nos solucionaria el problema de la etiqueta [sourcecode], pero funciono igual que la opcion anterior y encima debiamos activar el plugin de wordpress en el archivo de configuracion del sitio.</p>
<p>Como comentamos antes usamos la segunda opcion que nos creo la carpeta new_site con el contenido listo, asi que ahora debiamos construir el sitio:</p>
<pre class="code bash"><a name="rest_code_6ddb80bdd9284eb6adafe278b4bd5d75-1"></a>nikola build
</pre>
<p>Y lanzar el servidor de pruebas:</p>
<pre class="code bash"><a name="rest_code_d5d42569a7e44e41989af38406ad4259-1"></a>nikola serve -b
</pre>
<p>Cambiamos el tema por defecto por uno que nos parecio mas bonito llamado zen, pueden ver mas temas aqui:</p>
<p><a class="reference external" href="https://themes.getnikola.com">https://themes.getnikola.com</a></p>
<p>Lo instalamos asi:</p>
<pre class="code bash"><a name="rest_code_244ebd4fcb574f1180958d66addaa6e3-1"></a>nikola install_theme zen
</pre>
<p>Y lo configuramos en nuestro sitio modificando el archivo conf.py y cambiando la linea:</p>
<pre class="code python"><a name="rest_code_04afba205a6446db8a8f48b57776158d-1"></a><span class="n">THEME</span> <span class="o">=</span> <span class="s2">"bootstrap3"</span>
</pre>
<p>por:</p>
<pre class="code python"><a name="rest_code_61d9ad1f75f7433fb8fc7f75db938726-1"></a><span class="n">THEME</span> <span class="o">=</span> <span class="s2">"zen"</span>
</pre>
<p>y la linea:</p>
<pre class="code python"><a name="rest_code_e67fa88da5054b90b1b1f1428f29b904-1"></a><span class="n">NAVIGATION_LINKS</span> <span class="o">=</span> <span class="p">{</span>
<a name="rest_code_e67fa88da5054b90b1b1f1428f29b904-2"></a>        <span class="n">DEFAULT_LANG</span><span class="p">:</span> <span class="p">(</span>
<a name="rest_code_e67fa88da5054b90b1b1f1428f29b904-3"></a>            <span class="p">(</span><span class="s2">"/archive.html"</span><span class="p">,</span> <span class="s2">"Archives"</span><span class="p">),</span>
<a name="rest_code_e67fa88da5054b90b1b1f1428f29b904-4"></a>            <span class="p">(</span><span class="s2">"/categories/index.html"</span><span class="p">,</span> <span class="s2">"Tags"</span><span class="p">),</span>
<a name="rest_code_e67fa88da5054b90b1b1f1428f29b904-5"></a>            <span class="p">(</span><span class="s2">"/rss.xml"</span><span class="p">,</span> <span class="s2">"RSS feed"</span><span class="p">),</span>
<a name="rest_code_e67fa88da5054b90b1b1f1428f29b904-6"></a>        <span class="p">),</span>
<a name="rest_code_e67fa88da5054b90b1b1f1428f29b904-7"></a><span class="p">}</span>
</pre>
<p>Por:</p>
<pre class="code python"><a name="rest_code_a7f0f4f731fb4da3902558bcac385aa1-1"></a><span class="n">NAVIGATION_LINKS</span> <span class="o">=</span> <span class="p">{</span>
<a name="rest_code_a7f0f4f731fb4da3902558bcac385aa1-2"></a>    <span class="n">DEFAULT_LANG</span><span class="p">:</span> <span class="p">(</span>
<a name="rest_code_a7f0f4f731fb4da3902558bcac385aa1-3"></a>        <span class="p">(</span><span class="s1">'/index.html'</span><span class="p">,</span> <span class="s1">'Home'</span><span class="p">,</span> <span class="s1">'icon-home'</span><span class="p">),</span>
<a name="rest_code_a7f0f4f731fb4da3902558bcac385aa1-4"></a>        <span class="p">(</span><span class="s1">'/archive.html'</span><span class="p">,</span> <span class="s1">'Archives'</span><span class="p">,</span> <span class="s1">'icon-folder-open-alt'</span><span class="p">),</span>
<a name="rest_code_a7f0f4f731fb4da3902558bcac385aa1-5"></a>        <span class="p">(</span><span class="s1">'/categories/index.html'</span><span class="p">,</span> <span class="s1">'Tags'</span><span class="p">,</span> <span class="s1">'icon-tags'</span><span class="p">),</span>
<a name="rest_code_a7f0f4f731fb4da3902558bcac385aa1-6"></a>        <span class="p">(</span><span class="s1">'/rss.xml'</span><span class="p">,</span> <span class="s1">'RSS'</span><span class="p">,</span> <span class="s1">'icon-rss'</span><span class="p">),</span>
<a name="rest_code_a7f0f4f731fb4da3902558bcac385aa1-7"></a>        <span class="p">(</span><span class="s1">'https://getnikola.com'</span><span class="p">,</span> <span class="s1">'About me'</span><span class="p">,</span> <span class="s1">'icon-user'</span><span class="p">),</span>
<a name="rest_code_a7f0f4f731fb4da3902558bcac385aa1-8"></a>        <span class="p">(</span><span class="s1">'https://twitter.com/getnikola'</span><span class="p">,</span> <span class="s1">'My Twitter'</span><span class="p">,</span> <span class="s1">'icon-twitter'</span><span class="p">),</span>
<a name="rest_code_a7f0f4f731fb4da3902558bcac385aa1-9"></a>        <span class="p">(</span><span class="s1">'https://github.com/getnikola'</span><span class="p">,</span> <span class="s1">'My Github'</span><span class="p">,</span> <span class="s1">'icon-github'</span><span class="p">),</span>
<a name="rest_code_a7f0f4f731fb4da3902558bcac385aa1-10"></a>    <span class="p">)</span>
<a name="rest_code_a7f0f4f731fb4da3902558bcac385aa1-11"></a><span class="p">}</span>
</pre>
<p>Lo anterior es por defecto para que funcione, pero ya luego lo modificamos a nuestro gusto.</p>
<p>Volvimos a construir nuestro sitio:</p>
<pre class="code bash"><a name="rest_code_c8c6055dd79443f6aae81bdc9e1f9346-1"></a>nikola build
</pre>
<p>Y a lanzar nuestro servidor:</p>
<pre class="code bash"><a name="rest_code_83e40a28407a4577ac2a074a1c364b58-1"></a>nikola serve -b
</pre>
<p>Ahora si nos tocaba deployar nuestro sitio en github:</p>
<p>Para ello creamos un repositorio con el mismo nombre de nuestro usuario "pythonpiura" pero de la siguiente manera:</p>
<p>pythonpiura.github.io</p>
<p>Clonamos este repositorio:</p>
<pre class="code bash"><a name="rest_code_0db2e2226fa0412db91205b2a5161ed5-1"></a>git clone https://github.com/pythonpiura/pythonpiura.github.io.git
</pre>
<p>Lo siguiente que hicimos, fue copiar el contenido de nuestra carpeta new_site en la carpeta del repositorio recien creado.</p>
<p>Luego procedimos a modificar el archivo conf.py para que tenga los datos de nuetro nuevo sitio, modificando las siguientes lineas:</p>
<pre class="code python"><a name="rest_code_7c5db242b1b34c36b9bcd64add9ec130-1"></a><span class="n">SITE_URL</span> <span class="o">=</span> <span class="s2">"https://pythonpiura.github.io/"</span>
<a name="rest_code_7c5db242b1b34c36b9bcd64add9ec130-2"></a><span class="n">BLOG_EMAIL</span> <span class="o">=</span> <span class="s2">"pythonpiura@openmailbox.org"</span>
</pre>
<p>y tambien las siguientes para que se deploye correctamente en github:</p>
<pre class="code python"><a name="rest_code_82c996828d81407da7fa7a397d89f5dc-1"></a><span class="n">GITHUB_SOURCE_BRANCH</span> <span class="o">=</span> <span class="s1">'sources'</span>
<a name="rest_code_82c996828d81407da7fa7a397d89f5dc-2"></a><span class="n">GITHUB_DEPLOY_BRANCH</span> <span class="o">=</span> <span class="s1">'master'</span>
<a name="rest_code_82c996828d81407da7fa7a397d89f5dc-3"></a><span class="n">GITHUB_REMOTE_NAME</span> <span class="o">=</span> <span class="s1">'origin'</span>
</pre>
<p>Agregamos lo siguiente a nuestro archivo .gitignore para que este contenido no sea subido al repositorio:</p>
<pre class="code text"><a name="rest_code_f77233b59fd44499b26c39615271096a-1"></a>cache
<a name="rest_code_f77233b59fd44499b26c39615271096a-2"></a>.doit.db
<a name="rest_code_f77233b59fd44499b26c39615271096a-3"></a>__pycache__
<a name="rest_code_f77233b59fd44499b26c39615271096a-4"></a>output
</pre>
<p>Y corremos el comando:</p>
<pre class="code bash"><a name="rest_code_4d501a527609452ab6178ffc4064e697-1"></a>nikola github_deploy
</pre>
<p>En este paso github nos solicito nuestro usuario y password, lo ingresamos y continuamos. Tardo varios minutos en subir el contenido pero ya con eso tenemos nuestro blog en la siguiente direccion.</p>
<p><a class="reference external" href="http://pythonpiura.org/">http://pythonpiura.org/</a></p>
<p>Saludos.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="../posts/2016/06/18/ipython-y-jupyter/" class="u-url">IPython y Jupyter</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Comunidad Python Piura
            </span></p>
            <p class="dateline"><a href="../posts/2016/06/18/ipython-y-jupyter/" rel="bookmark"><time class="published dt-published" datetime="2016-06-18T04:46:26-05:00" title="2016-06-18 04:46">2016-06-18 04:46</time></a></p>
                <p class="commentline">
        
    <a href="../posts/2016/06/18/ipython-y-jupyter/#disqus_thread" data-disqus-identifier="cache/posts/2016/06/18/ipython-y-jupyter.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Despues de un receso hemos regresado y esta vez para hablar de IPython
y Jupyter, como todos sabemos cuando estamos aprendiendo Python
utilizamos el interprete directamente desde una terminal y vamos
probando nuestros programas, al principio todo nos va muy bien pero
luego notamos que nos vamos quedando cortos, es alli donde aparece
<a class="reference external" href="https://ipython.org/">IPython</a> que tal como nos dice su pagina web nos provee una
arquitectura rica para computación interactiva con:</p>
<ul class="simple">
<li>Una shell interactiva poderosa.</li>
<li>Un nucleo para Jupyter.</li>
<li>Soporte para visualización de datos interactivos y uso de
herramientas GUI.</li>
<li>Interprete embebido flexible para cargar en nuestros propios
proyectos.</li>
<li>Fácil de usar, herramientas de alta performance para computación
paralela.</li>
</ul>
<p>Vamos a instalarlo para ir conociendolo mejor, para ello vamos a
<a class="reference external" href="http://rukbottoland.com/blog/tutorial-de-python-virtualenv/">crear un entorno virtual</a>, al que llamaremos ipython:</p>
<pre class="code bash"><a name="rest_code_b792bec39fd04f76909feb2387aa03e7-1"></a>virtualenv ipython
</pre>
<p>Lo activamos:</p>
<pre class="code bash"><a name="rest_code_415573f3a1f14681bcbccf6131581be5-1"></a><span class="nb">source</span> ipython/bin/activate
</pre>
<p>Ahora procedemos a instalar ipython:</p>
<pre class="code bash"><a name="rest_code_3159189163714c91b2b8c9912524764e-1"></a>pip install ipython
</pre>
<p>Para probar que todo ha salido bien ponemos lo siguiente en la
terminal:</p>
<pre class="code bash"><a name="rest_code_ecf675017c084ed6a95bf9df13679374-1"></a>ipython
</pre>
<p>Y nos aparecerá algo como esto, que nos indica que todo esta
funcionando correctamente:</p>
<img alt="/images/blog/seleccic3b3n_369.png" src="../images/blog/seleccic3b3n_369.png"><p>Escribimos exit para salir del interprete y regresar a nuestra
terminal:</p>
<pre class="code bash"><a name="rest_code_26b3ebb917a547109988e50ade651f81-1"></a><span class="nb">exit</span>
</pre>
<p>Ahora conozcamos a <a class="reference external" href="http://jupyter.org/">Jupyter</a>, tal como nos dice su pagina web, es una
aplicación web que permite crear y compartir documentos que contienen
código vivo, ecuaciones, visualizaciones y texto explicativo. Se puede
usar para simulación numérica, simulación estadística, machine
learning y mucho mas.
Vamos a instalarlo para ir conociéndolo:</p>
<pre class="code bash"><a name="rest_code_aafd316de86b4c3592276cfb2d5d619e-1"></a>pip install jupyter
</pre>
<p>Para correrlo debemos escribir lo siguiente:</p>
<pre class="code bash"><a name="rest_code_57b29115ad684bea875378dec165a97f-1"></a>ipython notebook
</pre>
<p>Y automáticamente nos abrirá en una pestaña del navegador lo
siguiente:</p>
<img alt="/images/blog/seleccic3b3n_370.png" src="../images/blog/seleccic3b3n_370.png"><p>Aqui podemos crear un nuevo notebook, dando click al boton new en la
parte superior derecha y seleccionando Python 2:</p>
<img alt="/images/blog/seleccic3b3n_371.png" src="../images/blog/seleccic3b3n_371.png"><p>Nos aparece una especie de consola web donde podemos ir escribiendo
nuestros programas:</p>
<img alt="/images/blog/seleccic3b3n_373.png" src="../images/blog/seleccic3b3n_373.png"><p>Y ejecutando su contenido, como si trabajáramos en nuestra vieja
terminal:</p>
<img alt="/images/blog/seleccic3b3n_372.png" src="../images/blog/seleccic3b3n_372.png"><p>Maravilloso verdad, un interprete web, donde vamos escribiendo
nuestros programas y viendo su funcionamiento, agregando texto,
imagenes, generando graficos, podemos guardar cada noteboook,
exportarlo a pdf, intercambiarlo, etc, como veran es una herramienta
valiosisima para utilizar en la enseñanza, en el analisis de datos, en
los trabajos de investigacion, etc.</p>
<p>En la red podemos encontrar una gran de cantidad de notebooks listos
para descargar, hay tutoriales, tesis, trabajos de investigacion, etc.
A nosotros nos intereso el siguiente curso, que es introductorio al
leguaje Python:
<a class="reference external" href="http://ricardoduarte.github.io/python-for-developers/">Python For Developers</a></p>
<p>Vamos a descargar el archivo <a class="reference external" href="https://github.com/ricardoduarte/python-for-developers/zipball/master">zip</a> conteniendo todos los notebooks y
lo guardamos en la ruta desde donde ejecutamos el comando “ipython
notebook”, lo descomprimimos y tendremos lo siguiente:</p>
<img alt="/images/blog/seleccic3b3n_375.png" src="../images/blog/seleccic3b3n_375.png"><p>Como verán ahora ya nos aparece la carpeta donde esta el curso,
ingresamos a ella:</p>
<img alt="/images/blog/seleccic3b3n_376.png" src="../images/blog/seleccic3b3n_376.png"><p>Ahora ingresamos a uno de los capítulos:</p>
<img alt="/images/blog/seleccic3b3n_378.png" src="../images/blog/seleccic3b3n_378.png"><p>Seleccionamos el archivo con la extensión “ipynb” y veremos un hermoso
curso de introduccion a Python donde podemos ir interactuando con los
programas de ejemplo:</p>
<img alt="/images/blog/seleccic3b3n_377.png" src="../images/blog/seleccic3b3n_377.png"><p>Genial no, ahora aprender Python y hacer demostraciones de código va a
ser mas divertido :-)</p>
<p>Eso es todo por hoy, saludos.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="../posts/2016/05/13/reporte-pdf-en-django-con-reportlab/" class="u-url">Reporte PDF en Django con Reportlab</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Comunidad Python Piura
            </span></p>
            <p class="dateline"><a href="../posts/2016/05/13/reporte-pdf-en-django-con-reportlab/" rel="bookmark"><time class="published dt-published" datetime="2016-05-13T21:58:34-05:00" title="2016-05-13 21:58">2016-05-13 21:58</time></a></p>
                <p class="commentline">
        
    <a href="../posts/2016/05/13/reporte-pdf-en-django-con-reportlab/#disqus_thread" data-disqus-identifier="cache/posts/2016/05/13/reporte-pdf-en-django-con-reportlab.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Vamos a retomar nuestro proyecto tutorial, al que hemos tenido
bastante olvidado estos últimos días y haremos un reporte en pdf
utilizando la librería <a class="reference external" href="http://www.reportlab.com/">reportlab</a>, para ello la instalamos:</p>
<pre class="code bash"><a name="rest_code_99badd7f1e0f4140a20236fbba136b80-1"></a>pip install reportlab
</pre>
<p>Lo primero que haremos es poner el logo de django en la parte superior
de nuestro reporte, por lo que debemos tener la imagen guardada en una
ubicación fácil de obtener, por eso crearemos una carpeta llamada
“media” en nuestro proyecto y dentro de esta, otra carpeta llamada
imagenes, es aquí donde pondremos nuestro archivo logo_django.png:</p>
<img alt="/images/blog/ubicacion_logo.jpg" src="../images/blog/ubicacion_logo.jpg"><p>Modificamos el archivo settings.py para poder establecer la ruta de la
carpeta media:</p>
<pre class="code python"><a name="rest_code_cdb27626fb7447a498dd42b8bb636709-1"></a><span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">'media'</span><span class="p">)</span>
</pre>
<p>Creamos la clase ReportePersonasPDF en el archivo views.py, el código
está explicado en los comentarios:</p>
<pre class="code python"><a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-1"></a><span class="c1">#Importamos settings para poder tener a la mano la ruta de la carpeta media</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-2"></a><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-3"></a><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-4"></a><span class="kn">from</span> <span class="nn">reportlab.pdfgen</span> <span class="kn">import</span> <span class="n">canvas</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-5"></a><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">View</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-6"></a>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-7"></a><span class="k">class</span> <span class="nc">ReportePersonasPDF</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-8"></a>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-9"></a><span class="k">def</span> <span class="nf">cabecera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pdf</span><span class="p">):</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-10"></a>        <span class="c1">#Utilizamos el archivo logo_django.png que está guardado en la carpeta media/imagenes</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-11"></a>        <span class="n">archivo_imagen</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_ROOT</span><span class="o">+</span><span class="s1">'/imagenes/logo_django.png'</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-12"></a>        <span class="c1">#Definimos el tamaño de la imagen a cargar y las coordenadas correspondientes</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-13"></a>        <span class="n">pdf</span><span class="o">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">archivo_imagen</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span><span class="n">preserveAspectRatio</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-14"></a>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-15"></a><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-16"></a>        <span class="c1">#Indicamos el tipo de contenido a devolver, en este caso un pdf</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-17"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">'application/pdf'</span><span class="p">)</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-18"></a>        <span class="c1">#La clase io.BytesIO permite tratar un array de bytes como un fichero binario, se utiliza como almacenamiento temporal</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-19"></a>        <span class="nb">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-20"></a>        <span class="c1">#Canvas nos permite hacer el reporte con coordenadas X y Y</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-21"></a>        <span class="n">pdf</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="nb">buffer</span><span class="p">)</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-22"></a>        <span class="c1">#Llamo al método cabecera donde están definidos los datos que aparecen en la cabecera del reporte.</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-23"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cabecera</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-24"></a>        <span class="c1">#Con show page hacemos un corte de página para pasar a la siguiente</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-25"></a>        <span class="n">pdf</span><span class="o">.</span><span class="n">showPage</span><span class="p">()</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-26"></a>        <span class="n">pdf</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-27"></a>        <span class="n">pdf</span> <span class="o">=</span> <span class="nb">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-28"></a>        <span class="nb">buffer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-29"></a>        <span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
<a name="rest_code_7119f256fec249eb9ebde46315bc6a8e-30"></a>        <span class="k">return</span> <span class="n">response</span>
</pre>
<p>Para poder acceder a esta clase debemos hacer la creación de la url
correspondiente en el archivo urls.py:</p>
<pre class="code python"><a name="rest_code_1ef9be5dcae84dd286a25eab55affce9-1"></a><span class="n">url</span><span class="p">(</span><span class="s1">r'^reporte_personas_pdf/$'</span><span class="p">,</span><span class="n">login_required</span><span class="p">(</span><span class="n">ReportePersonasPDF</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span> <span class="n">name</span><span class="o">=</span><span class="s2">"reporte_personas_pdf"</span><span class="p">),</span>
</pre>
<p>Ahora vamos a utilizar la url desde el archivo personas.html:</p>
<pre class="code html"><a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-1"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">'form-group'</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-2"></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"row"</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-3"></a>        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-lg-9"</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-4"></a>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-5"></a>        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-6"></a>        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-lg-1"</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-7"></a>            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"{% url 'personas:reporte_personas_excel' %}"</span> <span class="na">class</span><span class="o">=</span><span class="s">"btn btn-info btn-block"</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-8"></a>                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"glyphicon glyphicon-list-alt"</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-9"></a>            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-10"></a>        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-11"></a>        {% if perms.personas.add_persona %}
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-12"></a>        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-lg-1"</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-13"></a>            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"{% url 'personas:crear_persona' %}"</span> <span class="na">class</span><span class="o">=</span><span class="s">"btn btn-info btn-block"</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-14"></a>                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"glyphicon glyphicon-plus"</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-15"></a>            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-16"></a>        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-17"></a>        {% endif %}
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-18"></a>        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"col-lg-1"</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-19"></a>            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">"{% url 'personas:reporte_personas_pdf' %}"</span> <span class="na">class</span><span class="o">=</span><span class="s">"btn btn-info btn-block"</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-20"></a>                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"glyphicon glyphicon-file"</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-21"></a>            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-22"></a>        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-23"></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a name="rest_code_b125a10bdf24441baa0587d23f7cbb07-24"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre>
<p>Nos tiene que aparecer un ícono de un archivo:</p>
<img alt="/images/blog/personas_pdf.jpg" src="../images/blog/personas_pdf.jpg"><p>El primer resultado será este:</p>
<img alt="/images/blog/reporte_pdf1.jpg" src="../images/blog/reporte_pdf1.jpg"><p>Vamos a ponerle un encabezado a nuestro reporte que diga “Python
Piura” y debajo “Reporte de Personas”, para ello colocamos el
siguiente código debajo de la última linea del método “cabecera”:</p>
<pre class="code python"><a name="rest_code_87816de618e34a09bfa7c251708c9b94-1"></a><span class="c1">#Establecemos el tamaño de letra en 16 y el tipo de letra Helvetica</span>
<a name="rest_code_87816de618e34a09bfa7c251708c9b94-2"></a><span class="n">pdf</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"Helvetica"</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<a name="rest_code_87816de618e34a09bfa7c251708c9b94-3"></a><span class="c1">#Dibujamos una cadena en la ubicación X,Y especificada</span>
<a name="rest_code_87816de618e34a09bfa7c251708c9b94-4"></a><span class="n">pdf</span><span class="o">.</span><span class="n">drawString</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">790</span><span class="p">,</span> <span class="s2">u"PYTHON PIURA"</span><span class="p">)</span>
<a name="rest_code_87816de618e34a09bfa7c251708c9b94-5"></a><span class="n">pdf</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="s2">"Helvetica"</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
<a name="rest_code_87816de618e34a09bfa7c251708c9b94-6"></a><span class="n">pdf</span><span class="o">.</span><span class="n">drawString</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">770</span><span class="p">,</span> <span class="s2">u"REPORTE DE PERSONAS"</span><span class="p">)</span>
</pre>
<img alt="/images/blog/reporte_pdf2.jpg" src="../images/blog/reporte_pdf2.jpg"><p>Visualizaremos la tabla de personas, por lo que creamos el método
tabla en la clase ReportePersonasPDF:</p>
<pre class="code python"><a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-1"></a><span class="k">def</span> <span class="nf">tabla</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pdf</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-2"></a>        <span class="c1">#Creamos una tupla de encabezados para neustra tabla</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-3"></a>        <span class="n">encabezados</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'DNI'</span><span class="p">,</span> <span class="s1">'Nombre'</span><span class="p">,</span> <span class="s1">'Apellido Paterno'</span><span class="p">,</span> <span class="s1">'Apellido Materno'</span><span class="p">)</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-4"></a>        <span class="c1">#Creamos una lista de tuplas que van a contener a las personas</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-5"></a>        <span class="n">detalles</span> <span class="o">=</span> <span class="p">[(</span><span class="n">persona</span><span class="o">.</span><span class="n">dni</span><span class="p">,</span> <span class="n">persona</span><span class="o">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">persona</span><span class="o">.</span><span class="n">apellido_paterno</span><span class="p">,</span> <span class="n">persona</span><span class="o">.</span><span class="n">apellido_materno</span><span class="p">)</span> <span class="k">for</span> <span class="n">persona</span> <span class="ow">in</span> <span class="n">Persona</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-6"></a>        <span class="c1">#Establecemos el tamaño de cada una de las columnas de la tabla</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-7"></a>        <span class="n">detalle_orden</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="n">encabezados</span><span class="p">]</span> <span class="o">+</span> <span class="n">detalles</span><span class="p">,</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">cm</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">cm</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">cm</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">cm</span><span class="p">])</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-8"></a>        <span class="c1">#Aplicamos estilos a las celdas de la tabla</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-9"></a>        <span class="n">detalle_orden</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">TableStyle</span><span class="p">(</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-10"></a>        <span class="p">[</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-11"></a>                <span class="c1">#La primera fila(encabezados) va a estar centrada</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-12"></a>                <span class="p">(</span><span class="s1">'ALIGN'</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="s1">'CENTER'</span><span class="p">),</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-13"></a>                <span class="c1">#Los bordes de todas las celdas serán de color negro y con un grosor de 1</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-14"></a>                <span class="p">(</span><span class="s1">'GRID'</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">black</span><span class="p">),</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-15"></a>                <span class="c1">#El tamaño de las letras de cada una de las celdas será de 10</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-16"></a>                <span class="p">(</span><span class="s1">'FONTSIZE'</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="p">),</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-17"></a>                <span class="p">]</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-18"></a>        <span class="p">))</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-19"></a>        <span class="c1">#Establecemos el tamaño de la hoja que ocupará la tabla</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-20"></a>        <span class="n">detalle_orden</span><span class="o">.</span><span class="n">wrapOn</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-21"></a>        <span class="c1">#Definimos la coordenada donde se dibujará la tabla</span>
<a name="rest_code_4538f62ceaef48949ff6cbbb6320dff8-22"></a>        <span class="n">detalle_orden</span><span class="o">.</span><span class="n">drawOn</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre>
<p>Veamos como queda nuestro método get ahora con la nueva llamada al
método tabla:</p>
<pre class="code python"><a name="rest_code_47d7923bc5b044edad76bc1e731095f9-1"></a><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-2"></a>        <span class="c1">#Indicamos el tipo de contenido a devolver, en este caso un pdf</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-3"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">'application/pdf'</span><span class="p">)</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-4"></a>        <span class="c1">#La clase io.BytesIO permite tratar un array de bytes como un fichero binario, se utiliza como almacenamiento temporal</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-5"></a>        <span class="nb">buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-6"></a>        <span class="c1">#Canvas nos permite hacer el reporte con coordenadas X y Y</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-7"></a>        <span class="n">pdf</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="nb">buffer</span><span class="p">)</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-8"></a>        <span class="c1">#Llamo al método cabecera donde están definidos los datos que aparecen en la cabecera del reporte.</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cabecera</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-10"></a>        <span class="n">y</span> <span class="o">=</span> <span class="mi">600</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tabla</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-12"></a>        <span class="c1">#Con show page hacemos un corte de página para pasar a la siguiente</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-13"></a>        <span class="n">pdf</span><span class="o">.</span><span class="n">showPage</span><span class="p">()</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-14"></a>        <span class="n">pdf</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-15"></a>        <span class="n">pdf</span> <span class="o">=</span> <span class="nb">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-16"></a>        <span class="nb">buffer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-17"></a>        <span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
<a name="rest_code_47d7923bc5b044edad76bc1e731095f9-18"></a>        <span class="k">return</span> <span class="n">response</span>
</pre>
<p>Y este será el resultado final:</p>
<img alt="/images/blog/reporte_pdf3.jpg" src="../images/blog/reporte_pdf3.jpg"><p>Eso es todo por hoy.
Saludos.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="../posts/2016/05/11/consulta-dni-reniec/" class="u-url">Consulta DNI - RENIEC</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Comunidad Python Piura
            </span></p>
            <p class="dateline"><a href="../posts/2016/05/11/consulta-dni-reniec/" rel="bookmark"><time class="published dt-published" datetime="2016-05-11T21:37:08-05:00" title="2016-05-11 21:37">2016-05-11 21:37</time></a></p>
                <p class="commentline">
        
    <a href="../posts/2016/05/11/consulta-dni-reniec/#disqus_thread" data-disqus-identifier="cache/posts/2016/05/11/consulta-dni-reniec.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>En esta oportunidad vamos a hacer un ejemplo mas complejo, ya que el
captcha así lo amerita, nuestra página objetivo es la siguiente:</p>
<p><a class="reference external" href="https://cel.reniec.gob.pe/valreg/valreg.do">https://cel.reniec.gob.pe/valreg/valreg.do</a></p>
<img alt="/images/blog/reniec.jpg" src="../images/blog/reniec.jpg"><p>En esta página podemos ingresar el número de DNI y obtener el nombre
completo del ciudadano. Como se ve en la imagen aquí nos enfrentamos a
un captcha mas completo y a un teclado dinámico compuesto de botones,
para romper este captcha tenemos que modificar la imagen para obtener
el texto correcto, eliminando las lineas que atraviesan las letras y
que tienen una tonalidad distinta de azul, el proceso no será 100%
seguro pero funciona en la mayoría de los casos:</p>
<pre class="code python"><a name="rest_code_45643eb54d144e69bfc710bb93978787-1"></a><span class="c1"># -*- coding: utf-8 -*-</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-2"></a><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-3"></a><span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-4"></a><span class="kn">from</span> <span class="nn">selenium.webdriver.support.wait</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-5"></a><span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-6"></a>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-7"></a><span class="k">try</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-8"></a>        <span class="kn">import</span> <span class="nn">Image</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-9"></a><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-10"></a>        <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-11"></a><span class="kn">import</span> <span class="nn">pytesseract</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-12"></a>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-13"></a><span class="k">def</span> <span class="nf">ir_reniec_web</span><span class="p">(</span><span class="n">dni</span><span class="p">):</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-14"></a>        <span class="n">fp</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">FirefoxProfile</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-15"></a>        <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-16"></a>        <span class="c1">#Definimos nuestra página objetivo</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-17"></a>        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://cel.reniec.gob.pe/valreg/valreg.do"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-18"></a>        <span class="k">try</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-19"></a>                <span class="c1">#Esperamos hasta que se cargue la imagen con el captcha</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-20"></a>                <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">"imagcodigo"</span><span class="p">)))</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-21"></a>        <span class="k">except</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-22"></a>                <span class="k">print</span> <span class="s2">"Element is not present"</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-23"></a>        <span class="c1">#Hacemos la captura de pantalla correspondiente</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-24"></a>        <span class="n">driver</span><span class="o">.</span><span class="n">save_screenshot</span><span class="p">(</span><span class="s2">"screenshot.png"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-25"></a>        <span class="n">img</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'screenshot.png'</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-26"></a>        <span class="c1">#Obtenemos el ancho y el largo de la imagen</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-27"></a>        <span class="n">ancho</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-28"></a>        <span class="n">alto</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-29"></a>        <span class="c1">#Recortamos la parte del captcha teniendo en cuenta el ancho y el largo de la imagen</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-30"></a>        <span class="n">img_recortada</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">ancho</span><span class="o">/</span><span class="mf">4.26</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">alto</span><span class="o">/</span><span class="mf">3.64</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">ancho</span><span class="o">/</span><span class="mf">2.8</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">alto</span><span class="o">/</span><span class="mi">3</span><span class="p">)))</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-31"></a>        <span class="c1">#Guardamos el recorte</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-32"></a>        <span class="n">img_recortada</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">"recorte.png"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-33"></a>        <span class="c1">#Recorremos cada uno de los dígitos del DNI</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-34"></a>        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">dni</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-35"></a>                <span class="c1">#Buscamos el boton que tenga como nombre tecla_0</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-36"></a>                <span class="n">boton_0</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_0"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-37"></a>                <span class="c1">#Obtenemos el valor del botón con nombre tecla_0</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-38"></a>                <span class="n">valor_0</span> <span class="o">=</span> <span class="n">boton_0</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-39"></a>                <span class="c1">#Buscamos el boton que tenga como nombre tecla_1</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-40"></a>                <span class="n">boton_1</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_1"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-41"></a>                <span class="c1">#Obtenemos el valor del botón con nombre tecla_1</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-42"></a>                <span class="n">valor_1</span> <span class="o">=</span> <span class="n">boton_1</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-43"></a>                <span class="c1">#Buscamos el boton que tenga como nombre tecla_2</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-44"></a>                <span class="n">boton_2</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_2"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-45"></a>                <span class="c1">#Obtenemos el valor del botón con nombre tecla_2</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-46"></a>                <span class="n">valor_2</span> <span class="o">=</span> <span class="n">boton_2</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-47"></a>                <span class="c1">#Buscamos el boton que tenga como nombre tecla_3</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-48"></a>                <span class="n">boton_3</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_3"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-49"></a>                <span class="c1">#Obtenemos el valor del botón con nombre tecla_3</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-50"></a>                <span class="n">valor_3</span> <span class="o">=</span> <span class="n">boton_3</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-51"></a>                <span class="c1">#Buscamos el boton que tenga como nombre tecla_4</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-52"></a>                <span class="n">boton_4</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_4"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-53"></a>                <span class="c1">#Obtenemos el valor del botón con nombre tecla_4</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-54"></a>                <span class="n">valor_4</span> <span class="o">=</span> <span class="n">boton_4</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-55"></a>                <span class="c1">#Buscamos el boton que tenga como nombre tecla_5</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-56"></a>                <span class="n">boton_5</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_5"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-57"></a>                <span class="c1">#Obtenemos el valor del botón con nombre tecla_5</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-58"></a>                <span class="n">valor_5</span> <span class="o">=</span> <span class="n">boton_5</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-59"></a>                <span class="c1">#Buscamos el boton que tenga como nombre tecla_6</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-60"></a>                <span class="n">boton_6</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_6"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-61"></a>                <span class="c1">#Obtenemos el valor del botón con nombre tecla_6</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-62"></a>                <span class="n">valor_6</span> <span class="o">=</span> <span class="n">boton_6</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-63"></a>                <span class="c1">#Buscamos el boton que tenga como nombre tecla_7</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-64"></a>                <span class="n">boton_7</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_7"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-65"></a>                <span class="c1">#Obtenemos el valor del botón con nombre tecla_7</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-66"></a>                <span class="n">valor_7</span> <span class="o">=</span> <span class="n">boton_7</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-67"></a>                <span class="c1">#Buscamos el boton que tenga como nombre tecla_8</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-68"></a>                <span class="n">boton_8</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_8"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-69"></a>                <span class="c1">#Obtenemos el valor del botón con nombre tecla_8</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-70"></a>                <span class="n">valor_8</span> <span class="o">=</span> <span class="n">boton_8</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-71"></a>                <span class="c1">#Buscamos el boton que tenga como nombre tecla_9</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-72"></a>                <span class="n">boton_9</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_9"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-73"></a>                <span class="c1">#Obtenemos el valor del botón con nombre tecla_9</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-74"></a>                <span class="n">valor_9</span> <span class="o">=</span> <span class="n">boton_9</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">'value'</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-75"></a>        <span class="c1">#Consultamos si el dígito del DNI es igual al valor del botón, si es el caso entonces se da click en ese botón</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-76"></a>        <span class="k">if</span> <span class="n">num</span><span class="o">==</span><span class="n">valor_0</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-77"></a>                <span class="n">boton_0</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-78"></a>        <span class="k">elif</span> <span class="n">num</span><span class="o">==</span><span class="n">valor_1</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-79"></a>                <span class="n">boton_1</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_1"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-80"></a>                <span class="n">boton_1</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-81"></a>        <span class="k">elif</span> <span class="n">num</span><span class="o">==</span><span class="n">valor_2</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-82"></a>                <span class="n">boton_2</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_2"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-83"></a>                <span class="n">boton_2</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-84"></a>        <span class="k">elif</span> <span class="n">num</span><span class="o">==</span><span class="n">valor_3</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-85"></a>                <span class="n">boton_3</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_3"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-86"></a>                <span class="n">boton_3</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-87"></a>        <span class="k">elif</span> <span class="n">num</span><span class="o">==</span><span class="n">valor_4</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-88"></a>                <span class="n">boton_4</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_4"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-89"></a>                <span class="n">boton_4</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-90"></a>        <span class="k">elif</span> <span class="n">num</span><span class="o">==</span><span class="n">valor_5</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-91"></a>                <span class="n">boton_5</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_5"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-92"></a>                <span class="n">boton_5</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-93"></a>        <span class="k">elif</span> <span class="n">num</span><span class="o">==</span><span class="n">valor_6</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-94"></a>                <span class="n">boton_6</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_6"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-95"></a>                <span class="n">boton_6</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-96"></a>        <span class="k">elif</span> <span class="n">num</span><span class="o">==</span><span class="n">valor_7</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-97"></a>                <span class="n">boton_7</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_7"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-98"></a>                <span class="n">boton_7</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-99"></a>        <span class="k">elif</span> <span class="n">num</span><span class="o">==</span><span class="n">valor_8</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-100"></a>                <span class="n">boton_8</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_8"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-101"></a>                <span class="n">boton_8</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-102"></a>        <span class="k">elif</span> <span class="n">num</span><span class="o">==</span><span class="n">valor_9</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-103"></a>                <span class="n">boton_9</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"tecla_9"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-104"></a>                <span class="n">boton_9</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-105"></a>        <span class="c1">#Se llama al método romper_captcha para obtener el texto correspondiente</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-106"></a>        <span class="n">captcha</span> <span class="o">=</span> <span class="n">romper_captcha</span><span class="p">(</span><span class="s2">"recorte.png"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-107"></a>        <span class="k">try</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-108"></a>                <span class="c1">#Obtenemos la caja de texto donde se escribe el texto del captcha</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-109"></a>                <span class="n">codigo</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"imagen"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-110"></a>                <span class="c1">#Si el captcha está vacio o no se ha logrado romper se cierra el navegador y se termina la aplicación</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-111"></a>                <span class="k">if</span> <span class="n">captcha</span><span class="o">==</span><span class="s2">""</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-112"></a>                        <span class="n">driver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-113"></a>                        <span class="k">return</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-114"></a>                <span class="c1">#Escribimos el texto</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-115"></a>                <span class="n">codigo</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">captcha</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-116"></a>        <span class="k">except</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-117"></a>                <span class="k">pass</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-118"></a>        <span class="k">try</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-119"></a>                <span class="c1">#Obtenemos el botón de consulta</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-120"></a>                <span class="n">boton_consultar</span><span class="o">=</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"bot_consultar"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-121"></a>                <span class="c1">#Damos click al botón de consulta</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-122"></a>                <span class="n">boton_consultar</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-123"></a>        <span class="k">except</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-124"></a>                <span class="k">print</span> <span class="s2">"Element is not present"</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-125"></a>        <span class="c1">#Obtengo el resultado que aparece en el elemento llamado style2</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-126"></a>        <span class="n">resultado</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s2">"style2"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-127"></a>        <span class="c1">#Partimos el resultado para obtener el nombre</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-128"></a>        <span class="n">nombre</span> <span class="o">=</span> <span class="n">resultado</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-129"></a>        <span class="n">driver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-130"></a>        <span class="k">return</span> <span class="n">nombre</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-131"></a>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-132"></a><span class="k">def</span> <span class="nf">romper_captcha</span><span class="p">(</span><span class="n">nombre_imagen</span><span class="p">):</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-133"></a>        <span class="c1">#Abro la imagen</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-134"></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">nombre_imagen</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-135"></a>        <span class="c1">#Obtengo un arreglo de píxeles de la imagen</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-136"></a>        <span class="n">pixdata</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-137"></a>        <span class="sd">"""Modifico los píxeles de la imagen de acuerdo al análisis de los</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-138"></a><span class="sd">        colores de las letras y las lineas que cruzan el texto, pintando de negro los píxeles del</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-139"></a><span class="sd">        texto y de blanco las lineas"""</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-140"></a>        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-141"></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-142"></a>                        <span class="k">if</span> <span class="n">pixdata</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">146</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-143"></a>                                <span class="n">pixdata</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-144"></a>        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-145"></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-146"></a>                        <span class="k">if</span> <span class="n">pixdata</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>     <span class="o">&gt;</span> <span class="mi">64</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-147"></a>                                <span class="n">pixdata</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-148"></a>                        <span class="k">else</span><span class="p">:</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-149"></a>                                <span class="n">pixdata</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-150"></a>        <span class="c1">#Guardo la imagen modificada</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-151"></a>        <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">"modificado.jpg"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-152"></a>        <span class="c1">#Abro la imagen modificado</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-153"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"modificado.jpg"</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-154"></a>        <span class="c1">#Obtenemos el texto de la imagen</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-155"></a>        <span class="n">frase</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-156"></a>        <span class="c1">#Retornamos el texto eliminado los espacios en blanco entre las palabras y convirtiendolas en mayúsculas</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-157"></a>        <span class="k">return</span> <span class="n">frase</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-158"></a>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-159"></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-160"></a>        <span class="n">dni</span> <span class="o">=</span> <span class="s1">'123456789'</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-161"></a>        <span class="k">print</span> <span class="n">ir_reniec_web</span><span class="p">(</span><span class="n">dni</span><span class="p">)</span>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-162"></a>
<a name="rest_code_45643eb54d144e69bfc710bb93978787-163"></a><span class="n">main</span><span class="p">()</span>
</pre>
<p>Espero que les sea útil.
Saludos.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="../posts/2016/05/10/otro-ejemplo-de-web-scrapping-con-python/" class="u-url">Otro Ejemplo de Web Scrapping con Python</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Comunidad Python Piura
            </span></p>
            <p class="dateline"><a href="../posts/2016/05/10/otro-ejemplo-de-web-scrapping-con-python/" rel="bookmark"><time class="published dt-published" datetime="2016-05-10T23:35:39-05:00" title="2016-05-10 23:35">2016-05-10 23:35</time></a></p>
                <p class="commentline">
        
    <a href="../posts/2016/05/10/otro-ejemplo-de-web-scrapping-con-python/#disqus_thread" data-disqus-identifier="cache/posts/2016/05/10/otro-ejemplo-de-web-scrapping-con-python.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>En esta oportunidad vamos a compartir con ustedes un nuevo script para
consultar rucs de manera masiva a partir del DNI en la página web de
sunat, esto ha sido un poco mas complejo debido a que la página en
cuestión usa frames, también hemos mejorado un poquito el problema de
los tamaños haciendo el recorte a partir del tamaño de la captura de
pantalla:</p>
<pre class="code python"><a name="rest_code_93c304482d514a3abced91f0a3291753-1"></a><span class="c1"># -*- coding: utf-8 -*-</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-2"></a><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-3"></a><span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-4"></a><span class="kn">from</span> <span class="nn">selenium.webdriver.support.wait</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-5"></a><span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-6"></a><span class="k">try</span><span class="p">:</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-7"></a>        <span class="kn">import</span> <span class="nn">Image</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-8"></a><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-9"></a>        <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-10"></a><span class="kn">import</span> <span class="nn">pytesseract</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-11"></a>
<a name="rest_code_93c304482d514a3abced91f0a3291753-12"></a><span class="k">def</span> <span class="nf">ir_sunat_web</span><span class="p">(</span><span class="n">dni</span><span class="p">):</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-13"></a>        <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-14"></a>        <span class="c1">#Fijamos nuestra página objetivo</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-15"></a>        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"http://ww1.sunat.gob.pe/cl-ti-itmrconsruc/jcrS00Alias"</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-16"></a>        <span class="k">try</span><span class="p">:</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-17"></a>                <span class="c1">#Debido a que la página tiene frames debemos hacer el cambio al frame con nombre "leftFrame"</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-18"></a>                <span class="n">driver</span><span class="o">.</span><span class="n">switch_to_frame</span><span class="p">(</span><span class="s2">"leftFrame"</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-19"></a>        <span class="k">except</span><span class="p">:</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-20"></a>                <span class="k">return</span> <span class="p">[]</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-21"></a>                <span class="n">driver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-22"></a>        <span class="k">try</span><span class="p">:</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-23"></a>                <span class="c1">#Obtenemos los radio buttons que nos permiten seleccionar el tipo de búsqueda a hacer</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-24"></a>                <span class="n">radios</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_name</span><span class="p">(</span><span class="s2">"tQuery"</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-25"></a>                <span class="c1">#Seleccionamos la búsqueda por DNI</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-26"></a>                <span class="n">radios</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-27"></a>                <span class="c1">#Obtenemos la caja de texto donde se ingresa el DNI</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-28"></a>                <span class="n">documento</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"search2"</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-29"></a>                <span class="c1">#Escribimos el DNI</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-30"></a>                <span class="n">documento</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">dni</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-31"></a>                <span class="c1">#Esperamos hasta que el texto esté escrito en la caja de texto del DNI</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-32"></a>                <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">text_to_be_present_in_element_value</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span><span class="s2">"search2"</span><span class="p">),</span><span class="n">dni</span><span class="p">))</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-33"></a>        <span class="k">except</span><span class="p">:</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-34"></a>                <span class="n">driver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-35"></a>                <span class="k">return</span> <span class="p">[]</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-36"></a>        <span class="k">try</span><span class="p">:</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-37"></a>                <span class="c1">#Esperamos hasta que se cargue la imagen con el captcha</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-38"></a>                <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="s2">"imagen"</span><span class="p">)))</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-39"></a>                <span class="c1">#Hacemos la captura de pantalla correspondiente</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-40"></a>                <span class="n">driver</span><span class="o">.</span><span class="n">save_screenshot</span><span class="p">(</span><span class="s2">"screenshot.jpg"</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-41"></a>                <span class="n">img</span><span class="o">=</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'screenshot.jpg'</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-42"></a>                <span class="c1">#Obtenemos el ancho y el largo de la imagen</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-43"></a>                <span class="n">ancho</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-44"></a>                <span class="n">alto</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-45"></a>                <span class="c1">#Recortamos la parte del captcha teniendo en cuenta el ancho y el largo de la imagen</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-46"></a>                <span class="n">img_recortada</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="n">ancho</span><span class="o">/</span><span class="mf">1.4</span><span class="p">,</span><span class="n">alto</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span><span class="n">ancho</span><span class="o">/</span><span class="mf">1.25</span><span class="p">,</span><span class="n">alto</span><span class="o">/</span><span class="mf">6.9</span><span class="p">))</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-47"></a>                <span class="c1">#Guardamos el recorte</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-48"></a>                <span class="n">img_recortada</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">"recorte.jpg"</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-49"></a>                <span class="c1">#Obtenemos el texto del captcha</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-50"></a>                <span class="n">captcha</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">img_recortada</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-51"></a>                <span class="c1">#Obtenemos la caja de texto donde se escribe el texto del captcha</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-52"></a>                <span class="n">codigo</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_name</span><span class="p">(</span><span class="s2">"codigo"</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-53"></a>                <span class="c1">#Escribimos el texto</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-54"></a>                <span class="n">codigo</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">captcha</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-55"></a>        <span class="k">except</span><span class="p">:</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-56"></a>                <span class="n">driver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-57"></a>                <span class="k">return</span> <span class="p">[]</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-58"></a>        <span class="k">try</span><span class="p">:</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-59"></a>                <span class="c1">#Obtenemos el botón de búsqueda</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-60"></a>                <span class="n">boton</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s2">"form-button"</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-61"></a>                <span class="c1">#Damos click al botón de búsqueda</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-62"></a>                <span class="n">boton</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-63"></a>                <span class="c1">#Cambiamos al frame por defecto</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-64"></a>                <span class="n">driver</span><span class="o">.</span><span class="n">switch_to_default_content</span><span class="p">()</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-65"></a>                <span class="c1">#Cambiamos al frame llamado "mainFrame" que contiene la tabla de resultados con un enlace conteniendo el ruc</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-66"></a>                <span class="n">driver</span><span class="o">.</span><span class="n">switch_to_frame</span><span class="p">(</span><span class="s2">"mainFrame"</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-67"></a>        <span class="k">except</span><span class="p">:</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-68"></a>                <span class="n">driver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-69"></a>                <span class="k">return</span> <span class="p">[]</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-70"></a>        <span class="k">try</span><span class="p">:</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-71"></a>                <span class="c1">#Esperamos que se cargue la tabla de resultados</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-72"></a>                <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s2">"form-table"</span><span class="p">)))</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-73"></a>                <span class="c1">#Obtenemos el enlace que contiene al RUC</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-74"></a>                <span class="n">enlace</span><span class="o">=</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span><span class="s2">"a"</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-75"></a>                <span class="c1">#Le damos click al enlace</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-76"></a>                <span class="n">enlace</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-77"></a>                <span class="c1">#Ahora si tenemos una tabla que contiene el detalle de los resultados del RUC consultado</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-78"></a>                <span class="c1">#Obtenemos todas las filas</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-79"></a>                <span class="n">trs</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">"tr"</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-80"></a>                <span class="c1">#Obtenemos las celdas de la primera fila</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-81"></a>                <span class="n">tds</span> <span class="o">=</span> <span class="n">trs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">"td"</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-82"></a>                <span class="c1">#A la segunda celda la partimos ya que tiene el ruc y la razón social separados por un guión</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-83"></a>                <span class="n">primera_linea</span> <span class="o">=</span> <span class="n">tds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'-'</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-84"></a>                <span class="n">ruc</span> <span class="o">=</span> <span class="n">primera_linea</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-85"></a>                <span class="n">razon_social</span> <span class="o">=</span> <span class="n">primera_linea</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-86"></a>                <span class="c1">#Obtenemos la segunda linea que tiene el tipo de contribuyente</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-87"></a>                <span class="n">tds</span> <span class="o">=</span> <span class="n">trs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">"td"</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-88"></a>                <span class="n">tipo_contribuyente</span> <span class="o">=</span> <span class="n">tds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-89"></a>                <span class="c1">#Obtenemos la dirección</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-90"></a>                <span class="n">tds</span> <span class="o">=</span> <span class="n">trs</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s2">"td"</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-91"></a>                <span class="n">direccion</span> <span class="o">=</span> <span class="n">tds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-92"></a>        <span class="k">except</span><span class="p">:</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-93"></a>                <span class="n">driver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-94"></a>                <span class="k">return</span> <span class="p">[]</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-95"></a>        <span class="n">driver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-96"></a>        <span class="c1">#Devolvemos una lista con los resultados.</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-97"></a>        <span class="n">datos</span> <span class="o">=</span> <span class="p">[</span><span class="n">ruc</span><span class="p">,</span><span class="n">razon_social</span><span class="p">,</span><span class="n">tipo_contribuyente</span><span class="p">,</span><span class="n">direccion</span><span class="p">]</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-98"></a>        <span class="k">return</span> <span class="n">datos</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-99"></a>
<a name="rest_code_93c304482d514a3abced91f0a3291753-100"></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-101"></a>        <span class="c1">#Ingresar DNI</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-102"></a>        <span class="n">dni</span> <span class="o">=</span> <span class="s1">'12345678'</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-103"></a>        <span class="k">print</span> <span class="n">ir_sunat_web</span><span class="p">(</span><span class="n">dni</span><span class="p">)</span>
<a name="rest_code_93c304482d514a3abced91f0a3291753-104"></a>
<a name="rest_code_93c304482d514a3abced91f0a3291753-105"></a><span class="n">main</span><span class="p">()</span>
</pre>
<iframe width="459" height="344" src="https://www.youtube.com/embed/ijICFYtAuDE?feature=oembed" frameborder="0" allowfullscreen></iframe><p>Esperamos que les sea útil.
Saludos.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="../posts/2016/05/09/fotos-charla-web-scrapping-con-python-y-selenium/" class="u-url">Fotos Charla Web Scrapping con Python y Selenium</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Comunidad Python Piura
            </span></p>
            <p class="dateline"><a href="../posts/2016/05/09/fotos-charla-web-scrapping-con-python-y-selenium/" rel="bookmark"><time class="published dt-published" datetime="2016-05-09T15:52:18-05:00" title="2016-05-09 15:52">2016-05-09 15:52</time></a></p>
                <p class="commentline">
        
    <a href="../posts/2016/05/09/fotos-charla-web-scrapping-con-python-y-selenium/#disqus_thread" data-disqus-identifier="cache/posts/2016/05/09/fotos-charla-web-scrapping-con-python-y-selenium.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <span><img alt="/images/blog/p5070212.jpg" src="../images/blog/p5070212.jpg"><img alt="/images/blog/p5070204.jpg" src="../images/blog/p5070204.jpg"><img alt="/images/blog/p5070208.jpg" src="../images/blog/p5070208.jpg"><img alt="/images/blog/p5070209.jpg" src="../images/blog/p5070209.jpg"><img alt="/images/blog/p5070210.jpg" src="../images/blog/p5070210.jpg"><img alt="/images/blog/p5070211.jpg" src="../images/blog/p5070211.jpg"></span>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="." rel="prev">Publicaciones posteriores</a>
            </li>
            <li class="next">
                <a href="index-2.html" rel="next">Publicaciones anteriores</a>
            </li>
        </ul></nav><script>var disqus_shortname="pythonpiura-org";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2017         <a href="mailto:pythonpiura@openmailbox.org">Comunidad Python Piura</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a>
            
        </footer>
</div>
</div>


            <script src="../assets/js/all-nocdn.js"></script><script src="../assets/js/colorbox-i18n/jquery.colorbox-es.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("es");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-8661664653028018",
    enable_page_level_ads: true
  });
</script><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76551557-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
