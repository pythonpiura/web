<html><body><p>En muchas de las páginas que consultamos tenemos una imagen que contiene un pequeño texto que generalmente es de 4 o de 6 letras, esta imagen es conocida como captcha y sirve para evitar la consulta masiva de datos y el uso de boots para hacer consultas, el problema radica en que podemos convertir esta imagen en texto y buscar la forma de ingresar estos datos de manera automática sin intervención humana. Para hacer la conversión de la imagen en texto tenemos la librería pytesseract que hace uso del programa tesseract-ocr y para el ingreso automático de datos y el acceso a la página objetivo contamos con la ayuda de nuestro viejo conocido selenium, cabe destacar que este procedimiento funciona siempre y cuando la imagen del captcha no sea tan complejo y contenga solamente texto.<br>
Hemos creado un script de manera general sin tener una página objetivo en específico, pero para aplicarlo se debe conocer bien la página a testear tal como hemos explicado en posts anteriores, analizando sus elementos y la ubicación del captcha.<br>
Antes de empezar debemos tener instalado el programa tesseract-ocr ya que no podremos hacer nada sin este, lo podemos descargar de la siguiente <a href="http://en.osdn.jp/projects/sfnet_tesseract-ocr-alt/downloads/tesseract-ocr-setup-3.02.02.exe/">ubicación</a>.</p>
<p>Posteriormente procedemos a instalar las librerias pytesseract y pillow(para el manejo y tratamiento de imágenes)</p>
<blockquote><p>pip install pillow<br>
pip install pytesseract</p></blockquote>
<p>Y finalmente hacemos nuestro script el cual está debidamente documentado para que lo puedan adaptar y modificar a su gusto.</p>
<p>[sourcecode language="python"]<br>
# -*- coding: utf-8 -*-<br>
from selenium import webdriver<br>
from selenium.webdriver.common.by import By<br>
from selenium.webdriver.support.wait import WebDriverWait<br>
from selenium.webdriver.support import expected_conditions as EC</p>
<p>try:<br>
    import Image<br>
except ImportError:<br>
    from PIL import Image<br>
import pytesseract</p>
<p>def ir_pagina_web(cadena,direccion_web):<br>
    driver = webdriver.Firefox()<br>
    #Vamos a la dirección web de la página objetivo<br>
    driver.get(direccion_web)<br>
    try:<br>
        #Esperamos que se cargue correctamente la caja de texto de búsqueda<br>
        WebDriverWait(driver, 5).until(EC.presence_of_element_located((By.ID, "txtBusqueda")))<br>
    except:<br>
        print "El elemento no está presente"<br>
    #Obtenemos la caja de texto de búsqueda<br>
    placa = driver.find_element_by_id("txtBusqueda")<br>
    #Enviamos la cadena a buscar en la caja de texto<br>
    placa.send_keys(cadena)<br>
    #Hacemos una captura de pantalla de la página objetivo<br>
    driver.save_screenshot("screenshot.jpg")<br>
    #Abrimos la captura hecha<br>
    img=Image.open(‘screenshot.jpg’)<br>
    #Recortamos la captura de acuerdo a la ubicación del captcha.<br>
    #El primer argumento es la posición "x" inicial, el segundo la posición "y" inicial.<br>
    #El tercer argumento es la posición "x" final y el cuarto la posición "y" final.<br>
    img_recortada = img.crop((380,300,550,340))<br>
    #Guardamos el área seleccionada con el nombre de "recorte.jpg"<br>
    img_recortada.save("recorte.jpg")<br>
    try:<br>
        #Convertimos la imagen a cadena de texto usando la libreria pytesseract<br>
        captcha = pytesseract.image_to_string(img_recortada)<br>
        #Obtenemos la caja de texto donde se ingresa el contenido del captcha<br>
        codigo = driver.find_element_by_id("txtCaptcha")<br>
        #Enviamos el captcha obtenido<br>
        codigo.send_keys(captcha)<br>
    except:<br>
        print "Error al convertir imagen en texto"<br>
    #Obtenemos el botón buscar<br>
    boton=driver.find_element_by_id("btn_buscar")<br>
    #Hacemos click en el botón<br>
    boton.click()<br>
    driver.close()</p>
<p>def main():<br>
    ir_pagina_web("cadena","direccion_web")</p>
<p>main()<br>
[/sourcecode]</p>
<p>Por cierto hemos realizado esta prueba en Windows, nos queda la tarea pendiente de hacerlo en GNU/Linux.</p>
</body></html>