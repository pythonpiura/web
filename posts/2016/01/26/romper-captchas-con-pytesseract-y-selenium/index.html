<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<base href="http://pythonpiura.org/posts/2016/01/26/romper-captchas-con-pytesseract-y-selenium/">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Romper Captchas con Pytesseract y Selenium | Python Piura</title>
<link href="../../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../../rss.xml">
<link rel="canonical" href="http://pythonpiura.org/posts/2016/01/26/romper-captchas-con-pytesseract-y-selenium/">
<!--[if lt IE 9]><script src="../../../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Miguel Amaya">
<link rel="prev" href="../../25/web-scraping-con-selenium/" title="Web Scraping con Selenium" type="text/html">
<link rel="next" href="../../../04/14/servir-aplicaciones-django-con-apache-y-mod_wsgi-en-centos-7/" title="Servir Aplicaciones Django con Apache y mod_wsgi en Centos 7" type="text/html">
<meta property="og:site_name" content="Python Piura">
<meta property="og:title" content="Romper Captchas con Pytesseract y Selenium">
<meta property="og:url" content="http://pythonpiura.org/posts/2016/01/26/romper-captchas-con-pytesseract-y-selenium/">
<meta property="og:description" content="En muchas de las páginas que consultamos tenemos una imagen que contiene un pequeño texto que generalmente es de 4 o de 6 letras, esta imagen es conocida como captcha y sirve para evitar la consulta m">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-01-26T14:17:00-05:00">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Selenium">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://pythonpiura.org/">

                <span id="blog-title">Python Piura</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../../../../blog">Blog</a>
                </li>
<li>
<a href="../../../../../eventos">Eventos</a>
                </li>
<li>
<a href="../../../../../recursos">Recursos</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.src.html" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Romper Captchas con Pytesseract y Selenium</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                    Miguel Amaya
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2016-01-26T14:17:00-05:00" itemprop="datePublished" title="2016-01-26 14:17">2016-01-26 14:17</time></a></p>
            
        <p class="sourceline"><a href="index.src.html" id="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>En muchas de las páginas que consultamos tenemos una imagen que contiene un pequeño texto que generalmente es de 4 o de 6 letras, esta imagen es conocida como captcha y sirve para evitar la consulta masiva de datos y el uso de boots para hacer consultas, el problema radica en que podemos convertir esta imagen en texto y buscar la forma de ingresar estos datos de manera automática sin intervención humana. Para hacer la conversión de la imagen en texto tenemos la librería pytesseract que hace uso del programa tesseract-ocr y para el ingreso automático de datos y el acceso a la página objetivo contamos con la ayuda de nuestro viejo conocido selenium, cabe destacar que este procedimiento funciona siempre y cuando la imagen del captcha no sea tan complejo y contenga solamente texto.<br>
Hemos creado un script de manera general sin tener una página objetivo en específico, pero para aplicarlo se debe conocer bien la página a testear tal como hemos explicado en posts anteriores, analizando sus elementos y la ubicación del captcha.<br>
Antes de empezar debemos tener instalado el programa tesseract-ocr ya que no podremos hacer nada sin este, lo podemos descargar de la siguiente <a href="http://en.osdn.jp/projects/sfnet_tesseract-ocr-alt/downloads/tesseract-ocr-setup-3.02.02.exe/">ubicación</a>.</p>
<p>Posteriormente procedemos a instalar las librerias pytesseract y pillow(para el manejo y tratamiento de imágenes)</p>
<blockquote><p>pip install pillow<br>
pip install pytesseract</p></blockquote>
<p>Y finalmente hacemos nuestro script el cual está debidamente documentado para que lo puedan adaptar y modificar a su gusto.</p>
<p>[sourcecode language="python"]<br>
# -*- coding: utf-8 -*-<br>
from selenium import webdriver<br>
from selenium.webdriver.common.by import By<br>
from selenium.webdriver.support.wait import WebDriverWait<br>
from selenium.webdriver.support import expected_conditions as EC</p>
<p>try:<br>
    import Image<br>
except ImportError:<br>
    from PIL import Image<br>
import pytesseract</p>
<p>def ir_pagina_web(cadena,direccion_web):<br>
    driver = webdriver.Firefox()<br>
    #Vamos a la dirección web de la página objetivo<br>
    driver.get(direccion_web)<br>
    try:<br>
        #Esperamos que se cargue correctamente la caja de texto de búsqueda<br>
        WebDriverWait(driver, 5).until(EC.presence_of_element_located((By.ID, "txtBusqueda")))<br>
    except:<br>
        print "El elemento no está presente"<br>
    #Obtenemos la caja de texto de búsqueda<br>
    placa = driver.find_element_by_id("txtBusqueda")<br>
    #Enviamos la cadena a buscar en la caja de texto<br>
    placa.send_keys(cadena)<br>
    #Hacemos una captura de pantalla de la página objetivo<br>
    driver.save_screenshot("screenshot.jpg")<br>
    #Abrimos la captura hecha<br>
    img=Image.open(‘screenshot.jpg’)<br>
    #Recortamos la captura de acuerdo a la ubicación del captcha.<br>
    #El primer argumento es la posición "x" inicial, el segundo la posición "y" inicial.<br>
    #El tercer argumento es la posición "x" final y el cuarto la posición "y" final.<br>
    img_recortada = img.crop((380,300,550,340))<br>
    #Guardamos el área seleccionada con el nombre de "recorte.jpg"<br>
    img_recortada.save("recorte.jpg")<br>
    try:<br>
        #Convertimos la imagen a cadena de texto usando la libreria pytesseract<br>
        captcha = pytesseract.image_to_string(img_recortada)<br>
        #Obtenemos la caja de texto donde se ingresa el contenido del captcha<br>
        codigo = driver.find_element_by_id("txtCaptcha")<br>
        #Enviamos el captcha obtenido<br>
        codigo.send_keys(captcha)<br>
    except:<br>
        print "Error al convertir imagen en texto"<br>
    #Obtenemos el botón buscar<br>
    boton=driver.find_element_by_id("btn_buscar")<br>
    #Hacemos click en el botón<br>
    boton.click()<br>
    driver.close()</p>
<p>def main():<br>
    ir_pagina_web("cadena","direccion_web")</p>
<p>main()<br>
[/sourcecode]</p>
<p>Por cierto hemos realizado esta prueba en Windows, nos queda la tarea pendiente de hacerlo en GNU/Linux.</p>

    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../../categories/python/" rel="tag">Python</a></li>
            <li><a class="tag p-category" href="../../../../../categories/selenium/" rel="tag">Selenium</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../../25/web-scraping-con-selenium/" rel="prev" title="Web Scraping con Selenium">Previous post</a>
            </li>
            <li class="next">
                <a href="../../../04/14/servir-aplicaciones-django-con-apache-y-mod_wsgi-en-centos-7/" rel="next" title="Servir Aplicaciones Django con Apache y mod_wsgi en Centos 7">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2016         <a href="mailto:ythonpiura@openmailbox.org">Miguel Amaya</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../../../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
