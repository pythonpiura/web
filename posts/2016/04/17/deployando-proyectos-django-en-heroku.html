<html><body><p style="text-align:justify;"><a href="https://www.heroku.com/">Heroku</a> es una plataforma que brinda servicios en la nube y soporta varios lenguajes de programación, funciona muy bien con Python y Django y en esta ocasión haremos un pequeño tutorial basado en el tutorial oficial, que se puede encontrar en la página del proyecto.<br>
Para empezar  a trabajar debemos tener una cuenta en Heroku, hay planes de varios tipos, nosotros escogeremos el plan Free. Antes de empezar nos vamos a cerciorar de tener instaladas algunas cosas básicas, que ya hemos visto antes pero que siempre es bueno recordar:</p>
<ul style="text-align:justify;">
<li>Pip.</li>
<li>Virtualenv</li>
<li>Git.</li>
<li>Y en nuestro caso la base de datos PostgreSQL.</li>
</ul>
<p style="text-align:justify;">El primer paso es instalar Heroku Toolbelt, esta aplicación provee acceso a la interfaz de linea de comandos(CLI) de Heroku, que es usada para administrar y escalar nuestras aplicaciones y sus añadidos, para tenerlo instalado debemos poner el siguiente comando en nuestra terminal:</p>
<p>[sourcecode language="bash"]<br>
wget -O- https://toolbelt.heroku.com/install-ubuntu.sh | sh<br>
[/sourcecode]</p>
<p style="text-align:justify;">El script nos pedira permisos de superusuario para continuar, se los damos y esperamos que la instalación se efectue.</p>
<p style="text-align:justify;">Una vez que hemos terminado de instalar debemos loguearnos utilizando el usuario y password que hemos registrado en la página de Heroku de la siguiente manera:</p>
<p>[sourcecode language="bash"]<br>
heroku login<br>
[/sourcecode]</p>
<p style="text-align:justify;">Si es la primera vez que lanzamos la aplicación se demorará un poquito instalando y configurando todo lo necesario, despues nos pedirá usuario y password, si ingresamos las credenciales correctamente nos saldrá un mensaje como este:</p>
<p>[sourcecode language="bash"]<br>
Logged in as miguel.amaya99@gmail.com<br>
[/sourcecode]</p>
<p style="text-align:justify;">Una vez que hemos hecho esto el manual oficial de Heroku nos indica que debemos clonar una aplicación de prueba para deployar, nosotros ya tenemos una aplicación desarrollada por lo que debemos hacer algunos cambios a esta para poder subirla sin ningún problema.</p>
<p style="text-align:justify;">Primero debemos agregar dos archivos en la raiz del proyecto:</p>
<p style="text-align:justify;">El archivo procfile que debe tener el siguiente contenido:</p>
<p>[sourcecode language="python"]<br>
web: gunicorn volpox.wsgi –log-file -<br>
[/sourcecode]</p>
<p style="text-align:justify;">En la parte donde dice “volpox.wsgi” se debe reemplazar por el nombre de su proyecto.</p>
<p style="text-align:justify;">El archivo requirements.txt debe tener todos las aplicaciones que nuestro proyecto necesita para funcionar correctamente, esto se puede averiguar facilmente ejecutando el comando pip freeze y guardando su contenido en el archivo, en nuestro caso el contenido del archivo es el siguiente:</p>
<p>[sourcecode language="python"]<br>
dj-database-url==0.4.0<br>
Django==1.9.2<br>
gunicorn==19.4.5<br>
psycopg2==2.6.1<br>
whitenoise==2.0.6<br>
[/sourcecode]</p>
<p style="text-align:justify;">Debemos tener en cuenta que este es el contenido básico para garantizar el correcto funcionamiento de nuestra aplicación en Heroku, hemos adicionado el paquete psycopg2 para poder trabajar con postgresql, si su proyecto usa algún paquete de software adicional, póngalo en este archivo.</p>
<p style="text-align:justify;">Ahora debemos modificar el archivo settings.py agregando las siguientes lineas:</p>
<p>[sourcecode language="python"]<br>
#Al inicio</p>
<p>import dj_database_url</p>
<p>PROJECT_ROOT = os.path.dirname(os.path.abspath(__file__))<br>
[/sourcecode]</p>
<p style="text-align:justify;">En la parte donde está:</p>
<p>[sourcecode language="python"]<br>
ALLOWED_HOSTS = []<br>
[/sourcecode]</p>
<p style="text-align:justify;">Lo cambiamos por:</p>
<p>[sourcecode language="python"]<br>
ALLOWED_HOSTS = ['*']<br>
[/sourcecode]</p>
<p style="text-align:justify;">En la parte final agregamos esto:</p>
<p>[sourcecode language="python"]<br>
db_from_env = dj_database_url.config(conn_max_age=500)<br>
DATABASES['default'].update(db_from_env)</p>
<p># Honor the ‘X-Forwarded-Proto’ header for request.is_secure()<br>
SECURE_PROXY_SSL_HEADER = (‘HTTP_X_FORWARDED_PROTO’, ‘https’)<br>
# Static files (CSS, JavaScript, Images)<br>
# https://docs.djangoproject.com/en/1.8/howto/static-files/</p>
<p>STATIC_ROOT = os.path.join(PROJECT_ROOT, ‘staticfiles’)</p>
<p>STATIC_URL = ‘/static/’</p>
<p># Extra places for collectstatic to find static files.<br>
STATICFILES_DIRS = (<br>
os.path.join(BASE_DIR, ‘static’),<br>
)<br>
STATICFILES_STORAGE = ‘whitenoise.django.GzipManifestStaticFilesStorage’<br>
[/sourcecode]</p>
<p>Ahora debemos cambiar el contenido del archivo wsgi.py</p>
<p>[sourcecode language="python"]<br>
import os<br>
os.environ.setdefault("DJANGO_SETTINGS_MODULE", "volpox.settings")</p>
<p>from django.core.wsgi import get_wsgi_application<br>
from whitenoise.django import DjangoWhiteNoise</p>
<p>application = get_wsgi_application()<br>
application = DjangoWhiteNoise(application)<br>
[/sourcecode]</p>
<p style="text-align:justify;">También debemos crear un archivo .gitignore, que es usado por git para no trabajar con las extensiones de archivos mencionados aquí en nuestro caso serán las siguientes:</p>
<p>[sourcecode language="python"]<br>
venv<br>
*.pyc<br>
staticfiles<br>
.env<br>
db.sqlite3<br>
[/sourcecode]</p>
<p style="text-align:justify;">Ahora debemos crear un repositorio git con el siguiente comando:</p>
<p>[sourcecode language="bash"]<br>
git init<br>
[/sourcecode]</p>
<p style="text-align:justify;">Añadimos los archivos:</p>
<p>[sourcecode language="bash"]<br>
git add *<br>
[/sourcecode]</p>
<p style="text-align:justify;">Y hacemos nuestro primer commit:</p>
<p>[sourcecode language="bash"]<br>
git commit -m "Deployando proyecto"<br>
[/sourcecode]</p>
<p style="text-align:justify;">Creamos nuestro proyecto en Heroku:</p>
<p>[sourcecode language="bash"]<br>
heroku create volpox<br>
[/sourcecode]</p>
<p style="text-align:justify;">Ahora si procedamos a subir nuestro proyecto a Heroku:</p>
<p>[sourcecode language="bash"]<br>
git push heroku master<br>
[/sourcecode]</p>
<p style="text-align:justify;">Si tuviesemos algún error, revisar los archivos de la carpeta static, generalmente la mayoría de errores se presentan por rutas no encontradas o cosas así.</p>
<p style="text-align:justify;">Si todo ha salido correctamente vamos a proceder a asegurarnos de que al menos una instancia de la aplicación se está ejecutando:</p>
<p>[sourcecode language="bash"]<br>
heroku ps:scale web=1<br>
[/sourcecode]</p>
<p style="text-align:justify;">Ahora abrimos el proyecto con el navegador por defecto:</p>
<p>[sourcecode language="bash"]<br>
heroku open<br>
[/sourcecode]</p>
<p style="text-align:justify;">Listo, ya tenemos nuestra aplicación funcionando correctamente, ahora falta configurar la base de datos, para ello vamos a utilizar el siguiente comando:</p>
<p>[sourcecode language="bash"]<br>
heroku addons<br>
[/sourcecode]</p>
<p style="text-align:justify;">Con esto añadimos una base de datos PostgreSQL en el plan Free de nuestra cuenta.<br>
Los siguiente comandos:</p>
<p>[sourcecode language="bash"]<br>
heroku config<br>
heroku pg<br>
[/sourcecode]</p>
<p style="text-align:justify;">Nos permiten ver la configuración de nuestra base de datos.</p>
<p style="text-align:justify;">Procedemos a crear nuestras tablas en la base de datos creada, usando el comando migrate de la siguiente manera:</p>
<p>[sourcecode language="bash"]<br>
heroku run python manage.py migrate<br>
[/sourcecode]</p>
<p style="text-align:justify;">Si es necesario procedemos a crear nuestro superusuario:</p>
<p>[sourcecode language="bash"]<br>
heroku run python manage.py createsuperuser<br>
[/sourcecode]</p>
<p style="text-align:justify;">Listo ya tenemos nuestra aplicación desplegada. Hasta la próxima.</p>
</body></html>