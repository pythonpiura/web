<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<base href="http://pythonpiura.org/posts/2016/04/14/servir-aplicaciones-django-con-apache-y-mod_wsgi-en-centos-7/">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Servir Aplicaciones Django con Apache y mod_wsgi en Centos 7 | Python Piura</title>
<link href="../../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../../rss.xml">
<link rel="canonical" href="http://pythonpiura.org/posts/2016/04/14/servir-aplicaciones-django-con-apache-y-mod_wsgi-en-centos-7/">
<!--[if lt IE 9]><script src="../../../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Miguel Amaya">
<link rel="prev" href="../../../01/26/romper-captchas-con-pytesseract-y-selenium/" title="Romper Captchas con Pytesseract y Selenium" type="text/html">
<link rel="next" href="../../16/curso-basico-de-python/" title="Curso Básico de Python" type="text/html">
<meta property="og:site_name" content="Python Piura">
<meta property="og:title" content="Servir Aplicaciones Django con Apache y mod_wsgi en Centos 7">
<meta property="og:url" content="http://pythonpiura.org/posts/2016/04/14/servir-aplicaciones-django-con-apache-y-mod_wsgi-en-centos-7/">
<meta property="og:description" content="Para instalar un servidor de producción Django en Centos 7 usaremos Apache y mod_wsgi, mod_wsgi es un módulo de Apache, que permite servir aplicaciones hechas en Python, que tengan soporte para la int">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-04-14T22:34:33-05:00">
<meta property="article:tag" content="Centos">
<meta property="article:tag" content="Django">
<meta property="article:tag" content="Python">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://pythonpiura.org/">

                <span id="blog-title">Python Piura</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../../../../blog">Blog</a>
                </li>
<li>
<a href="../../../../../eventos.html">Eventos</a>
                </li>
<li>
<a href="../../../../../material-python.html">Material</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.src.html" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Servir Aplicaciones Django con Apache y mod_wsgi en Centos 7</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                    Miguel Amaya
            </span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2016-04-14T22:34:33-05:00" itemprop="datePublished" title="2016-04-14 22:34">2016-04-14 22:34</time></a></p>
            
        <p class="sourceline"><a href="index.src.html" id="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p style="text-align:justify;">Para instalar un servidor de producción Django en Centos 7 usaremos Apache y mod_wsgi, mod_wsgi es un módulo de Apache, que permite servir aplicaciones hechas en Python, que tengan soporte para la interfaz WSGI.<br>
Los requisitos para esto son tener un servidor Centos 7 correctamente instalado y configurado y los permisos de root para poder hacer las instalaciones correspondientes. Para comenzar el proceso, vamos a descargar e instalar todos los elementos que necesitamos de los repositorios de la distribución. Esto incluirá el servidor web Apache, el módulo mod_wsgi utilizado para interactuar con nuestra aplicación Django, y pip. Para obtener pip, tendremos que habilitar el repositorio EPEL(paquetes para Linux Empresarial):</p>
<p>[sourcecode language="bash"]<br>
yum install epel-release<br>
[/sourcecode]</p>
<p>Con EPEL habilitado nosotros podemos instalar los componentes tipeando:</p>
<p>[sourcecode language="bash"]<br>
yum install python-pip httpd mod_wsgi<br>
[/sourcecode]</p>
<p style="text-align:justify;">Ahora que ya tenemos instalados los paquetes necesarios, debemos crear un entorno virtual para ellos instalaremos virtualenv usando pip:</p>
<p>[sourcecode language="bash"]<br>
pip install virtualenv<br>
[/sourcecode]</p>
<p>Ahora procedemos a crear nuestro entorno virtual:</p>
<p>[sourcecode language="bash"]<br>
virtualenv vproduccion<br>
[/sourcecode]</p>
<p>Y lo activamos:</p>
<p>[sourcecode language="bash"]<br>
source vproduccion/bin/activate<br>
[/sourcecode]</p>
<p style="text-align:justify;">Cuando activamos el entorno virtual nuestro prompt debe cambiar y aparecer entre paréntesis el nombre del entorno virtual activado.<br>
Una vez que esto ha sucedido debemos instalar Django:</p>
<p>[sourcecode language="bash"]<br>
pip install django<br>
[/sourcecode]</p>
<p style="text-align:justify;">Cuando ya tengamos listo esto, subimos o creamos nuestro proyecto Django utilizando los comandos clásicos que ya hemos utilizado antes, ahora nos toca configurar Apache.<br>
Una vez que comprobamos que el proyecto Django está funcionando, podemos configurar Apache como un front-end. Las conexiones de cliente que recibe serán traducidos al formato WSGI que la aplicación Django espera utilizando el módulo mod_wsgi. Esto debería haber sido activado automáticamente después de la instalación anterior. Para configurar lo anterior, tendremos que crear un nuevo archivo de configuración en el directorio /etc/httpd/conf.d. Vamos a llamar a este archivo django.conf:</p>
<p>[sourcecode language="bash"]<br>
nano /etc/httpd/conf.d/django.conf<br>
[/sourcecode]</p>
<p>Y dentro de él escribiremos lo siguiente:</p>
<p>[sourcecode language="bash"]<br>
#En mi caso la ruta es /home/jamaya y mi proyecto se llama siad<br>
#Configuración para mostrar correctamente losa archivos estáticos<br>
Alias /static /home/jamaya/siad/static<br>
&lt;Directory /home/jamaya/siad/static&gt;<br>
        Require all granted<br>
&lt;/Directory&gt;<br>
#Configuración para acceder correctamente al wsgi.py<br>
&lt;Directory /home/jamaya/siad/siad/&gt;<br>
&lt;Files wsgi.py&gt;<br>
        Require all granted<br>
&lt;/Files&gt;<br>
&lt;/Directory&gt;</p>
<p>WSGIDaemonProcess siad python-path=/home/jamaya/siad:/home/jamaya/vproduccion/lib/python2.7/site-packages<br>
WSGIProcessGroup siad<br>
WSGIScriptAlias /siad /home/jamaya/siad/siad/wsgi.py<br>
[/sourcecode]</p>
<p style="text-align:justify;">A continuación, tenemos que arreglar los permisos para que el servicio de Apache puede acceder a nuestros archivos. Por defecto CentOS bloquea el directorio personal de cada usuario de manera muy restrictiva. Para evitar esto, añadiremos el usuario apache al grupo de nuestro propio usuario. Esto nos permitirá abrir los permisos sólo lo suficiente para que pueda llegar a los archivos correspondientes.<br>
Añadimos el usuario apache a nuestro grupo, reemplazamos la palabra jamaya con nuestro usuario:</p>
<p>[sourcecode language="bash"]<br>
usermod -a -G jamaya apache<br>
[/sourcecode]</p>
<p>Damos permisos al grupo en la carpeta personal, esto permitirá al proceso apache acceder a los archivos.</p>
<p>[sourcecode language="bash"]<br>
chmod 710 /home/jamaya<br>
[/sourcecode]</p>
<p>Ya podemos iniciar el servicio de apache:</p>
<p>[sourcecode language="bash"]<br>
systemctl start httpd<br>
[/sourcecode]</p>
<p>Vamos a probar si la carga del proyecto funciona, vamos a otra computadora de la red y colocamos la direccion ip de nuestro servidor y la aplicación:</p>
<p>[sourcecode language="bash"]<br>
http://172.20.30.129/siad<br>
[/sourcecode]</p>
<p>Si hubiese algún problema lo mas rápido y sencillo es deshabilitar SELINUX, esto lo hacemos editando el archivo:</p>
<p>[sourcecode language="bash"]<br>
/etc/selinux/config<br>
[/sourcecode]</p>
<p>Y cambiando la siguiente linea:</p>
<p>[sourcecode language="bash"]<br>
SELINUX=disabled<br>
[/sourcecode]</p>
<p>Si todo funciona correctamente habilitamos el servicio apache para que se inicie automaticamente:</p>
<p>[sourcecode language="bash"]<br>
systemctl enable httpd<br>
[/sourcecode]</p>
<p>Recuerden tener siempre su archivo requerimientos.txt o requirements.txt para instalar todas las dependendencias que hacen que nuestro proyecto funcione con éxito. Este archivo se obtiene en nuestro entorno de desarrollo escribiendo el siguiente comando:</p>
<p>[sourcecode language="bash"]<br>
pip freeze &gt; requirements.txt<br>
[/sourcecode]</p>
<p>Y para instalarlas en nuestro entorno de producción usamos el mismo comando con algunas variantes:</p>
<p>[sourcecode language="bash"]<br>
pip install -r requirements.txt<br>
[/sourcecode]</p>
<p>En el caso nuestro teniamos un par de dependencias un poco complicadas de instalar en Centos: Pillow y psycopg2, por lo que tuvimos algunos errores, para solucionarlos debemos instalar algunas librerias, en centos en el caso de psycopg2 tenemos:</p>
<p>[sourcecode language="bash"]<br>
yum install gcc<br>
yum install postgresql-devel python-devel<br>
[/sourcecode]</p>
<p>Y en el caso de Pillow:</p>
<p>[sourcecode language="bash"]<br>
yum install libjpeg-devel zlib-devel<br>
[/sourcecode]</p>
<p>Y listo eso es todo, ya tenemos nuestro servidor de producción.</p>
<p>Saludos.</p>

    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../../categories/centos/" rel="tag">Centos</a></li>
            <li><a class="tag p-category" href="../../../../../categories/django/" rel="tag">Django</a></li>
            <li><a class="tag p-category" href="../../../../../categories/python/" rel="tag">Python</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../../../01/26/romper-captchas-con-pytesseract-y-selenium/" rel="prev" title="Romper Captchas con Pytesseract y Selenium">Previous post</a>
            </li>
            <li class="next">
                <a href="../../16/curso-basico-de-python/" rel="next" title="Curso Básico de Python">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2016         <a href="mailto:ythonpiura@openmailbox.org">Miguel Amaya</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../../../../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
